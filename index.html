<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRICE_LIST</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
<style>
* {
box-sizing: border-box;
margin: 0;
padding: 0;
font-family: 'Nanum Gothic', sans-serif;
}

body {
background-color: #f5f5f5;
padding: 20px;
}

.container {
max-width: 1200px;
margin: 0 auto;
background-color: white;
border-radius: 8px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
padding: 20px;
}

h1 {
text-align: center;
margin-bottom: 25px;
color: #2c3e50;
font-size: 36px;
font-weight: 700;
letter-spacing: 2px;
font-family: 'Nanum Gothic', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
text-transform: uppercase;
text-shadow: 0 2px 4px rgba(44, 62, 80, 0.1);
}

/* ê³µí†µ ì—…ë¡œë“œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
.common-upload-section {
margin-bottom: 25px;
padding: 20px;
background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
border-radius: 12px;
box-shadow: 0 4px 15px rgba(108, 117, 125, 0.2);
}

/* íƒ­ ìŠ¤íƒ€ì¼ */
.tabs {
display: flex;
border-bottom: none;
margin-bottom: 25px;
gap: 10px;
justify-content: center;
}

.tab {
padding: 14px 40px;
background-color: #fff;
border: 2px solid #e0e0e0;
border-radius: 50px;
cursor: pointer;
font-size: 16px;
font-weight: 700;
color: #666;
transition: all 0.3s ease;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.tab:hover {
background-color: #f8f9fa;
border-color: #6c757d;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(108, 117, 125, 0.15);
}

.tab.active {
background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
color: white;
border-color: transparent;
box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
transform: translateY(-2px);
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.upload-area {
text-align: center;
padding: 15px 20px;
cursor: pointer;
transition: all 0.3s ease;
min-height: 80px;
display: flex;
align-items: center;
justify-content: center;
background-color: rgba(255, 255, 255, 0.95);
border-radius: 8px;
border: 2px dashed rgba(255, 255, 255, 0.5);
}

.upload-area:hover {
background-color: rgba(255, 255, 255, 1);
border-color: rgba(255, 255, 255, 0.8);
transform: scale(1.01);
box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
}

.upload-area i {
font-size: 32px;
margin-bottom: 8px;
filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.upload-area h3 {
font-size: 16px;
margin-bottom: 4px;
color: #2c3e50;
font-weight: 700;
}

.upload-area p {
font-size: 12px;
margin: 2px 0;
color: #555;
}

.file-input {
display: none;
}

.file-info {
margin-top: 10px;
font-size: 14px;
color: #666;
}

.db-info {
margin-top: 15px;
padding: 15px;
background-color: rgba(255, 255, 255, 0.95);
border-radius: 8px;
display: none;
font-size: 14px;
border-left: 4px solid #4caf50;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.db-info h4 {
margin-bottom: 8px;
color: #2c3e50;
font-size: 16px;
font-weight: 700;
display: flex;
align-items: center;
gap: 8px;
}

.db-info h4:before {
content: "âœ“";
display: inline-block;
width: 24px;
height: 24px;
background: #4caf50;
color: white;
border-radius: 50%;
text-align: center;
line-height: 24px;
font-size: 14px;
}

.db-info p {
margin: 6px 0;
font-size: 13px;
color: #555;
padding-left: 32px;
}

.search-form {
display: grid;
grid-template-columns: repeat(5, 1fr);
gap: 15px 20px;
margin-bottom: 25px;
padding: 25px;
background: #f8f9fa;
border-radius: 12px;
display: none;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
border: 1px solid #dee2e6;
}

.form-group {
display: flex;
flex-direction: column;
}

label {
margin-bottom: 6px;
font-weight: 700;
color: #2c3e50;
font-size: 14px;
display: flex;
align-items: center;
gap: 6px;
}

label:before {
content: "â–¸";
color: #6c757d;
font-size: 12px;
}

.field-note {
font-size: 11px;
color: #666;
margin-top: 3px;
margin-bottom: 6px;
font-style: normal;
background-color: rgba(255, 255, 255, 0.5);
padding: 4px 8px;
border-radius: 4px;
}

select,
input[type="text"] {
padding: 10px 12px;
border: 2px solid #e0e0e0;
border-radius: 8px;
font-size: 14px;
background-color: white;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 500;
width: 100%;
}

select:hover,
input[type="text"]:hover {
border-color: #6c757d;
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.1);
}

select:focus,
input[type="text"]:focus {
outline: none;
border-color: #6c757d;
box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.08);
cursor: text;
}

.buttons {
display: flex;
justify-content: center;
gap: 10px;
margin-top: 20px;
grid-column: 1 / -1;
}

button {
padding: 12px 32px;
background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
color: white;
border: none;
border-radius: 8px;
cursor: pointer;
font-weight: 700;
font-size: 15px;
transition: all 0.3s ease;
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.2);
}

button:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

button:active {
transform: translateY(0);
}

.reset-btn {
background: linear-gradient(135deg, #adb5bd 0%, #868e96 100%);
box-shadow: 0 2px 8px rgba(173, 181, 189, 0.2);
}

.reset-btn:hover {
box-shadow: 0 4px 12px rgba(173, 181, 189, 0.3);
}

.results {
margin-top: 25px;
}

.results h2 {
color: #2c3e50;
font-size: 22px;
font-weight: 800;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 3px solid #6c757d;
display: inline-block;
}

.sort-controls {
display: flex;
justify-content: flex-end;
align-items: center;
margin-bottom: 15px;
gap: 12px;
padding: 12px;
background-color: #f8f9fa;
border-radius: 8px;
}

.sort-controls label {
font-size: 14px;
color: #2c3e50;
font-weight: 700;
}

.sort-controls select {
padding: 8px 16px;
border: 2px solid #e0e0e0;
border-radius: 8px;
font-size: 14px;
cursor: pointer;
font-weight: 500;
background-color: white;
transition: all 0.3s ease;
width: auto;
}

.sort-controls select:hover {
border-color: #6c757d;
}

table {
width: 100%;
border-collapse: separate;
border-spacing: 0;
margin-top: 15px;
font-size: 14px;
background-color: white;
border-radius: 12px;
overflow: hidden;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
border: 1px solid #dee2e6;
}

th, td {
padding: 18px 16px;
text-align: left;
border-bottom: 1px solid #e9ecef;
word-break: keep-all;
white-space: nowrap;
}

th {
background: linear-gradient(135deg, #495057 0%, #343a40 100%);
font-weight: 800;
color: white;
font-size: 14px;
letter-spacing: 0.3px;
text-align: center;
vertical-align: middle;
border-right: 1px solid rgba(255, 255, 255, 0.1);
}

th:last-child {
border-right: none;
}

td {
font-size: 14px;
color: #212529;
vertical-align: middle;
}

tbody tr {
transition: all 0.2s ease;
}

tbody tr:hover {
background-color: #f8f9fa;
}

tbody tr:nth-child(even) {
background-color: #fafbfc;
}

tbody tr:nth-child(even):hover {
background-color: #f1f3f5;
}

.price-value {
color: #dc3545;
font-weight: 800;
font-size: 15px;
text-align: right;
}

.no-results {
text-align: center;
padding: 40px 20px;
color: #666;
font-size: 16px;
background: #f8f9fa;
border-radius: 12px;
margin: 20px 0;
border: 1px solid #dee2e6;
}

.loading {
text-align: center;
padding: 30px;
display: none;
font-size: 18px;
color: #6c757d;
font-weight: 600;
animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
0%, 100% {
opacity: 1;
}
50% {
opacity: 0.5;
}
}

.status-message {
text-align: center;
padding: 14px 20px;
margin: 12px 0;
border-radius: 8px;
font-size: 14px;
font-weight: 500;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
animation: slideIn 0.3s ease;
}

@keyframes slideIn {
from {
opacity: 0;
transform: translateY(-10px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

.success {
background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
color: #155724;
border-left: 4px solid #28a745;
}

.error {
background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
color: #721c24;
border-left: 4px solid #dc3545;
}

.info {
background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
color: #0c5460;
border-left: 4px solid #17a2b8;
}

/* í•©ê³„ í–‰ ìŠ¤íƒ€ì¼ */
.total-row {
background: #f8f9fa !important;
font-weight: 700;
border-top: 3px solid #6c757d;
box-shadow: 0 -2px 10px rgba(108, 117, 125, 0.1);
}

.total-label {
text-align: right;
color: #2c3e50;
font-size: 16px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.total-amount {
color: #dc3545;
font-weight: 700;
font-size: 18px;
}

/* ëª¨ë°”ì¼ ìµœì í™” */
@media screen and (max-width: 768px) {
body {
padding: 12px;
}

.container {
padding: 15px;
}

h1 {
font-size: 24px;
margin-bottom: 20px;
}

.tabs {
gap: 8px;
flex-wrap: wrap;
}

.tab {
padding: 12px 24px;
font-size: 14px;
flex: 1;
min-width: 120px;
}

.search-form {
grid-template-columns: 1fr;
padding: 20px;
gap: 15px;
}

.common-upload-section {
padding: 15px;
}

.upload-area {
padding: 12px 15px;
min-height: 70px;
}

.upload-area i {
font-size: 28px;
}

.upload-area h3 {
font-size: 14px;
}

.results h2 {
font-size: 18px;
}

.sort-controls {
flex-direction: row;
justify-content: flex-end;
align-items: center;
gap: 12px;
padding: 12px;
}

.sort-controls label {
text-align: left;
}

.sort-controls select {
width: auto;
}

/* ESSA íƒ­ì—ë§Œ ì ìš©ë˜ëŠ” ëª¨ë°”ì¼ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
#essa-tab table {
font-size: 13px;
box-shadow: none;
border: none;
}

#essa-tab table thead {
display: none;
}

#essa-tab table, #essa-tab table tbody, #essa-tab table tr, #essa-tab table td {
display: block;
width: 100%;
}

#essa-tab tbody tr {
margin-bottom: 20px;
border: 2px solid #dee2e6;
border-radius: 12px;
padding: 18px;
background: #ffffff;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#essa-tab tbody tr:hover {
background: #f8f9fa;
transform: none;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#essa-tab tbody tr:nth-child(even) {
background: #ffffff;
}

#essa-tab tbody tr:nth-child(even):hover {
background: #f8f9fa;
}

#essa-tab table td {
padding: 10px 0;
text-align: left !important;
border-bottom: 1px solid #e9ecef;
display: flex;
align-items: flex-start;
white-space: normal;
word-break: break-word;
font-weight: 400;
line-height: 1.6;
}

#essa-tab table td:last-child {
border-bottom: none;
padding-bottom: 0;
}

#essa-tab table td:before {
content: attr(data-label);
display: inline-block;
font-weight: 700;
color: #495057;
min-width: 90px;
max-width: 90px;
margin-right: 10px;
flex-shrink: 0;
}

#essa-tab table td.price-value {
text-align: left !important;
}

#essa-tab table td.price-value:before {
content: attr(data-label);
}

/* ACE íƒ­ë„ ESSA íƒ­ê³¼ ë™ì¼í•œ ì¹´ë“œë·° ì ìš© */
#ace-tab table {
font-size: 13px;
box-shadow: none;
border: none;
}

#ace-tab table thead {
display: none;
}

#ace-tab table, #ace-tab table tbody, #ace-tab table tr, #ace-tab table td {
display: block;
width: 100%;
}

#ace-tab tbody tr {
margin-bottom: 20px;
border: 2px solid #dee2e6;
border-radius: 12px;
padding: 18px;
background: #ffffff;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#ace-tab tbody tr:hover {
background: #f8f9fa;
transform: none;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#ace-tab tbody tr:nth-child(even) {
background: #ffffff;
}

#ace-tab tbody tr:nth-child(even):hover {
background: #f8f9fa;
}

#ace-tab table td {
padding: 10px 0;
text-align: left !important;
border-bottom: 1px solid #e9ecef;
display: flex;
align-items: flex-start;
white-space: normal;
word-break: break-word;
font-weight: 400;
line-height: 1.6;
}

#ace-tab table td:last-child {
border-bottom: none;
padding-bottom: 0;
}

#ace-tab table td:before {
content: attr(data-label);
display: inline-block;
font-weight: 700;
color: #495057;
min-width: 90px;
max-width: 90px;
margin-right: 10px;
flex-shrink: 0;
}

#ace-tab table td.price-value {
text-align: left !important;
}

#ace-tab table td.price-value:before {
content: attr(data-label);
}

/* ACE íƒ­ ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
#ace-tab .quantity-input {
width: 60px;
padding: 6px 8px;
font-size: 13px;
border: 2px solid #6c757d;
border-radius: 6px;
text-align: center;
font-weight: 600;
}

#ace-tab .quantity-input:focus {
border-color: #495057;
box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.1);
outline: none;
}

/* ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ëª¨ë“  íƒ­ ì¹´ë“œë·° ì ìš© */

/* ACE íƒ­ ì´ í•©ê³„ ìŠ¤íƒ€ì¼ - PC í™˜ê²½ */
#ace-tab .total-row {
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
border-top: 3px solid #6c757d;
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.1);
}

#ace-tab .total-row td {
padding: 12px 8px !important;
border-bottom: none !important;
font-size: 14px;
font-weight: 700;
line-height: 1.3;
vertical-align: middle;
}

/* í• ì¸ìœ¨ ì…€ (ì²« ë²ˆì§¸ ì—´) */
#ace-tab .total-row td:first-child {
text-align: center;
background: #f8f9fa;
width: 20%;
}

/* ì´í•©ê³„ ë¼ë²¨ (ì¤‘ê°„ ì—´ë“¤) */
#ace-tab .total-row .total-label {
text-align: right;
color: #2c3e50;
text-transform: uppercase;
letter-spacing: 0.5px;
padding-right: 16px;
}

/* ì´í•©ê³„ ê¸ˆì•¡ (ë§ˆì§€ë§‰ ì—´) */
#ace-tab .total-row td:last-child {
text-align: right;
color: #dc3545;
font-weight: 800;
padding-right: 16px;
width: 20%;
}

#ace-tab .total-row td:before {
content: none !important;
display: none !important;
}

.total-row {
margin-top: 20px;
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
border: 3px solid #6c757d;
border-radius: 12px;
padding: 20px;
text-align: center;
box-shadow: 0 4px 15px rgba(108, 117, 125, 0.2);
}

.total-row td {
text-align: center !important;
border: none;
font-size: 16px;
display: block !important;
padding: 0 !important;
}

.total-row td:before {
content: none !important;
display: none !important;
}

.total-label {
color: #2c3e50;
font-size: 18px;
font-weight: 800;
margin-bottom: 0;
display: inline !important;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.total-amount {
color: #dc3545;
font-size: 24px;
font-weight: 800;
display: inline !important;
margin-left: 10px;
}

.mobile-total-container {
display: flex;
justify-content: center;
align-items: center;
flex-wrap: nowrap;
gap: 10px;
}

.mobile-total-text {
color: #2c3e50;
font-size: 18px;
font-weight: 800;
white-space: nowrap;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.mobile-total-amount {
color: #dc3545;
font-size: 24px;
font-weight: 800;
white-space: nowrap;
}




}

/* ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
.quantity-input {
width: 70px;
padding: 8px 12px;
border: 2px solid #e0e0e0;
border-radius: 6px;
font-size: 14px;
font-weight: 600;
text-align: center;
background-color: white;
transition: all 0.3s ease;
}

.quantity-input:hover {
border-color: #6c757d;
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.1);
}

.quantity-input:focus {
outline: none;
border-color: #6c757d;
box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.08);
}

.quantity-cell {
text-align: center;
}

.total-price {
font-weight: 700;
color: #dc3545;
}



/* í• ì¸ìœ¨ ë° ìƒí’ˆê¶Œ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
.discount-input, .discount-input-pc, .regional-discount-input, .regional-discount-input-pc {
width: 80px;
padding: 6px 8px;
border: 2px solid #e0e0e0;
border-radius: 6px;
font-size: 14px;
font-weight: 600;
text-align: center;
background-color: white;
transition: all 0.3s ease;
margin: 0 4px;
}

.discount-input:hover, .discount-input-pc:hover, .regional-discount-input:hover, .regional-discount-input-pc:hover {
border-color: #6c757d;
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.1);
}

.discount-input:focus, .discount-input-pc:focus, .regional-discount-input:focus, .regional-discount-input-pc:focus {
outline: none;
border-color: #6c757d;
box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.08);
}

/* PC í™˜ê²½ í• ì¸ìœ¨ ì»¨í…Œì´ë„ˆ */
.discount-container {
display: flex;
align-items: center;
justify-content: center;
gap: 4px;
font-size: 14px;
font-weight: 700;
color: #2c3e50;
}

.discount-cell {
text-align: center;
background: #f8f9fa;
}

/* ìµœì í™”ëœ ACE íƒ­ ëª¨ë°”ì¼ ì¹´ë“œë·° ìŠ¤íƒ€ì¼ */
@media screen and (max-width: 768px) {
/* ê¸°ì¡´ ì¹´ë“œë·°ì™€ í†µì¼ëœ í• ì¸ìœ¨/ìƒí’ˆê¶Œ/ì´í•©ê³„ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.ace-mobile-summary-card, .essa-mobile-summary-card {
margin-bottom: 20px;
border: 2px solid #dee2e6;
border-radius: 12px;
padding: 18px;
background: #ffffff;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.ace-mobile-summary-card:hover, .essa-mobile-summary-card:hover {
background: #f8f9fa;
transform: none;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.summary-row {
padding: 10px 0;
text-align: left !important;
border-bottom: 1px solid #e9ecef;
display: flex;
align-items: flex-start;
white-space: normal;
word-break: break-word;
font-weight: 400;
line-height: 1.6;
}

.summary-row:last-child {
border-bottom: none;
padding-bottom: 0;
}

.summary-label {
display: inline-block;
font-weight: 700;
color: #495057;
min-width: 90px;
max-width: 90px;
margin-right: 10px;
flex-shrink: 0;
font-size: 14px;
}

.summary-input-group {
display: flex;
align-items: center;
gap: 8px;
flex: 1;
}

.summary-input {
width: 70px;
padding: 8px 12px;
border: 2px solid #e0e0e0;
border-radius: 6px;
font-size: 14px;
font-weight: 600;
text-align: center;
background-color: white;
transition: all 0.3s ease;
}

.summary-input:hover {
border-color: #6c757d;
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.1);
}

.summary-input:focus {
outline: none;
border-color: #6c757d;
box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.08);
}

.summary-unit {
font-size: 14px;
font-weight: 700;
color: #495057;
}

.summary-amount {
font-size: 15px;
font-weight: 800;
color: #dc3545;
text-align: left;
flex: 1;
}

/* ë¦¬ì…‹ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.reset-button {
padding: 6px 12px;
background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
color: white;
border: none;
border-radius: 6px;
cursor: pointer;
font-size: 12px;
font-weight: 600;
transition: all 0.3s ease;
margin-left: 8px;
min-width: 50px;
}

.reset-button:hover {
background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
transform: translateY(-1px);
box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
}

.reset-button:active {
transform: translateY(0);
}

/* PC í™˜ê²½ ì´í•©ê³„ ê°€ê²© í‘œì‹œ ìŠ¤íƒ€ì¼ */
.total-price-container {
display: flex;
align-items: center;
justify-content: flex-end;
gap: 4px;
}

.original-price {
color: #6c757d;
font-size: 14px;
font-weight: 600;
}

.price-separator {
color: #6c757d;
font-size: 14px;
font-weight: 600;
}

.final-price {
color: #dc3545;
font-size: 18px;
font-weight: 800;
}

/* ëª¨ë°”ì¼ í™˜ê²½ ì´í•©ê³„ ê°€ê²© í‘œì‹œ ìŠ¤íƒ€ì¼ */
.summary-total-container {
display: flex;
align-items: center;
gap: 6px;
flex: 1;
}

.summary-original-price {
color: #6c757d;
font-size: 13px;
font-weight: 600;
}

.summary-separator {
color: #6c757d;
font-size: 13px;
font-weight: 600;
}

.summary-final-price {
color: #dc3545;
font-size: 15px;
font-weight: 800;
}

/* í• ì¸ìœ¨ í–‰ ë¼ë²¨ ìƒ‰ìƒ */
.summary-row:first-child .summary-label {
color: #495057;
}

/* ìƒí’ˆê¶Œ í–‰ ë¼ë²¨ ìƒ‰ìƒ */
.summary-row:nth-child(2) .summary-label {
color: #495057;
}

/* ì´í•©ê³„ í–‰ ë¼ë²¨ ìƒ‰ìƒ */
.summary-row:last-child .summary-label {
color: #495057;
}
}

/* ëª¨ë°”ì¼ì—ì„œ ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ */
@media screen and (max-width: 768px) {
.quantity-input {
width: 60px;
padding: 6px 8px;
font-size: 13px;
}

.discount-input {
width: 80px;
padding: 8px 12px;
font-size: 16px;
border-radius: 8px;
border: 2px solid #2196f3;
font-weight: 600;
background-color: white;
text-align: center;
}

.discount-input:focus {
border-color: #1976d2;
box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
outline: none;
}

.discount-input:hover {
border-color: #1976d2;
box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
}

.regional-discount-input {
width: 80px;
padding: 8px 12px;
font-size: 16px;
border-radius: 8px;
border: 2px solid #ff9800;
font-weight: 600;
background-color: white;
text-align: center;
}

.regional-discount-input:focus {
border-color: #f57c00;
box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
outline: none;
}

.regional-discount-input:hover {
border-color: #f57c00;
box-shadow: 0 2px 8px rgba(255, 152, 0, 0.15);
}

/* ëª¨ë°”ì¼ í• ì¸ìœ¨ í–‰ê³¼ ì´í•©ê³„ í–‰ ë°˜ì‘í˜• ìµœì í™” */
.discount-row, .total-row {
width: 100%;
}

.mobile-discount-container, .mobile-total-container {
width: 100%;
box-sizing: border-box;
}

/* ì‘ì€ í™”ë©´ì—ì„œë„ ê¸°ì¡´ ì¹´ë“œë·°ì™€ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ìœ ì§€ */
@media screen and (max-width: 480px) {
.ace-mobile-summary-card, .essa-mobile-summary-card {
margin-bottom: 15px;
padding: 15px;
}

.summary-row {
padding: 8px 0;
}

.summary-label {
min-width: 80px;
max-width: 80px;
font-size: 13px;
}

.summary-input {
width: 60px;
padding: 6px 10px;
font-size: 13px;
}

.summary-unit {
font-size: 13px;
}

.summary-amount {
font-size: 14px;
}
}

/* ì¤‘ê°„ í¬ê¸° í™”ë©´ ìµœì í™” */
@media screen and (min-width: 481px) and (max-width: 600px) {
.ace-mobile-summary-card, .essa-mobile-summary-card {
padding: 16px;
}

.summary-label {
font-size: 14px;
}

.summary-input {
width: 65px;
padding: 7px 11px;
font-size: 14px;
}

.summary-unit {
font-size: 14px;
}

.summary-amount {
font-size: 15px;
}
}

/* íƒœë¸”ë¦¿ ìµœì í™” */
@media screen and (min-width: 601px) and (max-width: 768px) {
.ace-mobile-summary-card, .essa-mobile-summary-card {
padding: 18px;
}

.summary-label {
font-size: 14px;
}

.summary-input {
width: 70px;
padding: 8px 12px;
font-size: 14px;
}

.summary-unit {
font-size: 14px;
}

.summary-amount {
font-size: 15px;
}
}
}

/* ESSA íƒ­ ëª¨ë°”ì¼ ì¹´ë“œë·° ìµœì í™” */
@media screen and (max-width: 768px) {
.essa-mobile-summary-card {
margin-bottom: 15px;
padding: 12px;
}

.essa-mobile-summary-card .summary-row {
padding: 6px 0;
border-bottom: 1px solid #e9ecef;
}

.essa-mobile-summary-card .summary-row:last-child {
border-bottom: none;
padding-bottom: 0;
}

.essa-mobile-summary-card .summary-label {
min-width: 65px;
max-width: 65px;
font-size: 13px;
font-weight: 700;
color: #495057;
}

.essa-mobile-summary-card .summary-input-group {
gap: 4px;
}

/* ê¸ˆì•¡í• ì¸ê³¼ í• ì¸ìœ¨ ì…ë ¥ í•„ë“œ í†µì¼ ë””ìì¸ */
.essa-mobile-summary-card .summary-input {
width: 85px;
padding: 6px 8px;
font-size: 13px;
text-align: right;
border: 1px solid #dee2e6;
border-radius: 4px;
background-color: #fff;
font-weight: 600;
transition: all 0.2s ease;
}

.essa-mobile-summary-card .summary-input:focus {
outline: none;
border-color: #6c757d;
box-shadow: 0 0 0 2px rgba(108, 117, 125, 0.1);
}

.essa-mobile-summary-card .summary-input:hover {
border-color: #adb5bd;
}

.essa-mobile-summary-card .summary-unit {
font-size: 12px;
font-weight: 600;
color: #495057;
min-width: 18px;
}

.essa-mobile-summary-card .reset-button {
padding: 4px 8px;
font-size: 10px;
min-width: 40px;
background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
font-weight: 600;
transition: all 0.2s ease;
}

.essa-mobile-summary-card .reset-button:hover {
background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
transform: translateY(-1px);
box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2);
}

.essa-mobile-summary-card .reset-button:active {
transform: translateY(0);
}
}
</style>
</head>
<body>
<div class="container">
<h1>PRICE_LIST</h1>

<!-- ê³µí†µ ì—…ë¡œë“œ ì„¹ì…˜ (í•œ ë²ˆë§Œ ì—…ë¡œë“œ) -->
<div class="common-upload-section">
<div class="upload-area" id="uploadArea">
<div>
<i>ğŸ“</i>
<h3>SQLite ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ì—…ë¡œë“œ</h3>
<p>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
<p class="file-info">ì§€ì› í˜•ì‹: .db, .sqlite, .sqlite3 (ë‘ íƒ­ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥)</p>
</div>
<input type="file" id="fileInput" class="file-input" accept=".db,.sqlite,.sqlite3">
</div>
<div id="statusMessage"></div>
<div id="dbInfo" class="db-info"></div>
</div>

<!-- íƒ­ ë©”ë‰´ -->
<div class="tabs">
<button class="tab active" onclick="switchTab('essa')">ESSA</button>
<button class="tab" onclick="switchTab('ace')">ACE</button>
</div>

<!-- ESSA íƒ­ ë‚´ìš© -->
<div id="essa-tab" class="tab-content active">
<div class="search-form" id="searchForm-essa">
<div class="form-group">
<label for="essa_p_name">ìƒí’ˆëª…</label>
<div class="field-note">ì„ íƒì‹œ ë‹¤ë¥¸ ì˜µì…˜ë“¤ì´ í•„í„°ë§ë¨</div>
<select id="essa_p_name" onchange="updateEssaDependentOptions('p_name')">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_size">ì‚¬ì´ì¦ˆ</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ì‚¬ì´ì¦ˆë§Œ í‘œì‹œ</div>
<select id="essa_size" onchange="updateEssaDependentOptions('size')">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_size_option">ì‚¬ì´ì¦ˆ ì˜µì…˜</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ì˜µì…˜ë§Œ í‘œì‹œ</div>
<select id="essa_size_option">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_material">ì†Œì¬</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ì†Œì¬ë§Œ í‘œì‹œ</div>
<select id="essa_material" onchange="updateEssaDependentOptions('material')">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_fabric">ì›ë‹¨</label>
<div class="field-note">ì†Œì¬ ì„ íƒì‹œ í•´ë‹¹ ì›ë‹¨ë§Œ í‘œì‹œ</div>
<select id="essa_fabric">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_function">ê¸°ëŠ¥</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ê¸°ëŠ¥ë§Œ í‘œì‹œ</div>
<select id="essa_function">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_stool">ìŠ¤íˆ´ í¬í•¨</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ì˜µì…˜ë§Œ í‘œì‹œ</div>
<select id="essa_stool">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_style">ìŠ¤íƒ€ì¼</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ìŠ¤íƒ€ì¼ë§Œ í‘œì‹œ</div>
<select id="essa_style">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_leather_option">ê°€ì£½ ì˜µì…˜</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ì˜µì…˜ë§Œ í‘œì‹œ</div>
<select id="essa_leather_option">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="essa_event_product">í–‰ì‚¬ ì œí’ˆ</label>
<div class="field-note">ìƒí’ˆëª… ì„ íƒì‹œ í•´ë‹¹ ì˜µì…˜ë§Œ í‘œì‹œ</div>
<select id="essa_event_product">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="buttons">
<button onclick="searchProducts('essa')">ê²€ìƒ‰</button>
<button onclick="resetForm('essa')" class="reset-btn">ì´ˆê¸°í™”</button>
</div>
</div>

<div class="loading" id="loading-essa">ğŸ” ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</div>

<div class="results">
<h2>ê²€ìƒ‰ ê²°ê³¼</h2>
<div id="results-container-essa"></div>
</div>
</div>

<!-- ACE íƒ­ ë‚´ìš© -->
<div id="ace-tab" class="tab-content">
<div class="search-form" id="searchForm-ace">
<div class="form-group">
<label for="ace_frame">í”„ë ˆì„</label>
<div class="field-note">í”„ë ˆì„ ì„ íƒì‹œ í•´ë‹¹ íƒ€ì…/ì‚¬ì´ì¦ˆ í‘œì‹œ</div>
<select id="ace_frame" onchange="updateDependentOptions('ace')">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_type">íƒ€ì…</label>
<div class="field-note">í”„ë ˆì„ ì„ íƒ ì‹œ ì—°ë™ë¨</div>
<select id="ace_type">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_mattress">ë§¤íŠ¸ë¦¬ìŠ¤</label>
<div class="field-note">í”„ë ˆì„ ë¯¸ì„ íƒ ì‹œ ì‚¬ì´ì¦ˆì™€ ì—°ë™ë¨</div>
<select id="ace_mattress" onchange="updateDependentOptions('ace')">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_size">ì‚¬ì´ì¦ˆ</label>
<div class="field-note">í”„ë ˆì„/ë§¤íŠ¸ë¦¬ìŠ¤ ì„ íƒ ì‹œ ì—°ë™ë¨</div>
<select id="ace_size">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_foundation">íŒŒìš´ë°ì´ì…˜</label>
<div class="field-note">íŒŒìš´ë°ì´ì…˜ íƒ€ì… ì„ íƒ</div>
<select id="ace_foundation">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_related_items">ì—°ê³„ í’ˆëª©</label>
<div class="field-note">í”„ë ˆì„/ë§¤íŠ¸ë¦¬ìŠ¤ì™€ ë…ë¦½ì </div>
<select id="ace_related_items">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_nightstand">í˜‘íƒ</label>
<div class="field-note">ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ ë¡œë“œ</div>
<select id="ace_nightstand">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_sideboard">ì‚¬ì´ë“œë³´ë“œ</label>
<div class="field-note">ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ ë¡œë“œ</div>
<select id="ace_sideboard">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_furniture">ê°€êµ¬</label>
<div class="field-note">ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ ë¡œë“œ</div>
<select id="ace_furniture">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="form-group">
<label for="ace_category">êµ¬ë¶„</label>
<div class="field-note">ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ ë¡œë“œ</div>
<select id="ace_category">
<option value="">ì „ì²´</option>
</select>
</div>

<div class="buttons">
<button onclick="searchProducts('ace')">ê²€ìƒ‰</button>
<button onclick="resetForm('ace')" class="reset-btn">ì´ˆê¸°í™”</button>
</div>
</div>

<div class="loading" id="loading-ace">ğŸ” ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</div>

<div class="results">
<h2>ê²€ìƒ‰ ê²°ê³¼</h2>
<div id="results-container-ace"></div>
</div>
</div>
</div>

<script>
const CONFIG = {
SQLJSCDN: 'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0',
ALLOWED_EXTENSIONS: /\.(db|sqlite|sqlite3)$/i,
// GitHub ìë™ ë¡œë“œ ì„¤ì • (ì‚¬ìš©ì ìˆ˜ì • í•„ìš”)
GITHUB: {
username: 'ysace0077',            // GitHub ì‚¬ìš©ìëª…
repository: 'essa_price',         // ë¦¬í¬ì§€í† ë¦¬ëª…
branch: 'main',                   // ë¸Œëœì¹˜ëª… (main ë˜ëŠ” master)
dataFolder: 'data',               // ë°ì´í„° í´ë”ëª…
enabled: true                     // GitHub ìë™ ë¡œë“œ í™œì„±í™”/ë¹„í™œì„±í™”
},
FIELD_MAPPING: {
essa: {
p_name: ['P_NAME', 'ìƒí’ˆëª…', 'PRODUCT_NAME', 'NAME'],
size: ['SIZE', 'ì‚¬ì´ì¦ˆ'],
size_option: ['SIZE ì˜µì…˜', 'SIZE_OPTION', 'ì‚¬ì´ì¦ˆì˜µì…˜', 'ì‚¬ì´ì¦ˆ ì˜µì…˜', 'SIZEOPTION'],
material: ['MATERIAL', 'ì†Œì¬'],
fabric: ['FABRIC', 'ì›ë‹¨'],
function: ['FUNCTION', 'ê¸°ëŠ¥'],
stool: ['ìŠ¤íˆ´í¬í•¨', 'STOOL', 'ìŠ¤íˆ´', 'ìŠ¤íˆ´ í¬í•¨', 'STOOL í¬í•¨', 'STOOLí¬í•¨'],
style: ['STYLE', 'ìŠ¤íƒ€ì¼'],
leather_option: ['ê°€ì£½ì˜µì…˜', 'LEATHER_OPTION', 'ê°€ì£½ ì˜µì…˜', 'LEATHEROPTION'],
event_product: ['í–‰ì‚¬ì œí’ˆ', 'í–‰ì‚¬ ì œí’ˆ', 'EVENT_PRODUCT', 'EVENT', 'ì´ë²¤íŠ¸']
},
ace: {
frame: ['í”„ë ˆì„', 'FRAME', 'FRAME_TYPE', 'í”„ë ˆì„íƒ€ì…'],
type: ['íƒ€ì…', 'TYPE', 'TYPE_NM', 'BED_TYPE'],
mattress: ['ë§¤íŠ¸ë¦¬ìŠ¤', 'MATTRESS', 'MATTRESS_TYPE', 'ë§¤íŠ¸ë¦¬ìŠ¤íƒ€ì…'],
foundation: ['íŒŒìš´ë°ì´ì…˜', 'FOUNDATION', 'FOUNDATION_TYPE', 'íŒŒìš´ë°ì´ì…˜íƒ€ì…'],
size: ['SIZE', 'ì‚¬ì´ì¦ˆ', 'BED_SIZE'],
related_items: ['ì—°ê³„ í’ˆëª©', 'ì—°ê³„í’ˆëª©', 'RELATED_ITEMS', 'ì—°ê³„', 'RELATED_PRODUCTS', 'ì—°ê³„í’ˆëª©ì½”ë“œ', 'RELATED_ITEM_CODE'],
nightstand: ['í˜‘íƒ', 'NIGHTSTAND', 'í˜‘íƒí¬í•¨', 'NIGHTSTAND_YN'],
sideboard: ['ì‚¬ì´ë“œë³´ë“œ', 'SIDEBOARD', 'ì‚¬ì´ë“œë³´ë“œí¬í•¨', 'SIDEBOARD_YN'],
furniture: ['ê°€êµ¬', 'FURNITURE', 'FURNITURE_TYPE', 'ê°€êµ¬íƒ€ì…'],
category: ['êµ¬ë¶„', 'CATEGORY', 'CATEGORY_NM', 'ë¶„ë¥˜']
}
},
DISPLAY_COLUMNS: {
essa: [
{ keys: ['í’ˆëª©ì½”ë“œ', 'PRODUCT_CODE', 'CODE', 'ì½”ë“œ'], label: 'í’ˆëª©ì½”ë“œ' },
{ keys: ['ìƒí’ˆëª…', 'P_NAME', 'PRODUCT_NAME', 'NAME'], label: 'ìƒí’ˆëª…' },
{ keys: ['ì‚¬ì´ì¦ˆ', 'SIZE'], label: 'ì‚¬ì´ì¦ˆ' },
{ keys: ['íŒë§¤ê°€', 'PRICE', 'SALE_PRICE', 'ê°€ê²©', 'PRICE_AMOUNT'], label: 'íŒë§¤ê°€' },
{ keys: ['í–‰ì‚¬ì œí’ˆ', 'í–‰ì‚¬ ì œí’ˆ', 'EVENT_PRODUCT', 'EVENT', 'ì´ë²¤íŠ¸'], label: 'í–‰ì‚¬ê°€' }
],
ace: [
{ keys: ['êµ¬ë¶„', 'CATEGORY', 'CATEGORY_NM', 'ë¶„ë¥˜'], label: 'êµ¬ë¶„' },
{ keys: ['ìƒí’ˆëª…', 'P_NAME', 'PRODUCT_NAME', 'NAME'], label: 'ìƒí’ˆëª…' },
{ keys: ['ì‚¬ì´ì¦ˆ', 'SIZE', 'BED_SIZE'], label: 'ì‚¬ì´ì¦ˆ' },
{ keys: ['ìƒ‰ìƒ', 'COLOR', 'COLOR_NM', 'ìƒ‰ìƒëª…'], label: 'ìƒ‰ìƒ' },
{ keys: ['QUANTITY'], label: 'ìˆ˜ëŸ‰' },
{ keys: ['íŒë§¤ê°€', 'PRICE', 'SALE_PRICE', 'ê°€ê²©', 'ê¸ˆì•¡', 'PRICE_AMOUNT', 'AMOUNT'], label: 'íŒë§¤ê°€' }
]
},
TABLE_CONFIG: {
essa: 'DATA',
ace: 'DATA_1'
}
};

// ê³µìœ  ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ (í•œ ë²ˆë§Œ ë¡œë“œ)
const state = {
db: null,  // ê³µìœ  DB
fileName: '',
essa: { 
tableInfo: null, 
currentProducts: [], 
currentSort: 'none',
totalAmount: 0 
},
ace: { 
tableInfo: null, 
currentProducts: [], 
currentSort: 'none', 
totalAmount: 0 
}
};

// íƒ­ ì „í™˜
function switchTab(tabName) {
document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
event.target.classList.add('active');
document.getElementById(`${tabName}-tab`).classList.add('active');
}

// ê³µí†µ ì—…ë¡œë“œ ì´ˆê¸°í™” (í•œ ë²ˆë§Œ)
function initUpload() {
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');

uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', (e) => {
e.preventDefault();
uploadArea.style.backgroundColor = '#f0f0f0';
});

uploadArea.addEventListener('dragleave', () => {
uploadArea.style.backgroundColor = '';
});

uploadArea.addEventListener('drop', (e) => {
e.preventDefault();
uploadArea.style.backgroundColor = '';
if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]);
});

fileInput.addEventListener('change', (e) => {
if (e.target.files[0]) handleFileUpload(e.target.files[0]);
});

// ìë™ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹œë„
tryAutoLoadDatabase();
}

// GitHubì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ìë™ ë¡œë“œ í•¨ìˆ˜
async function tryAutoLoadDatabase() {
console.log('ğŸ”„ ìë™ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹œì‘');
console.log('ğŸ“‹ GitHub ì„¤ì •:', CONFIG.GITHUB);

// GitHub ì„¤ì •ì´ í™œì„±í™”ë˜ì–´ ìˆê³  ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì‹œë„
if (!CONFIG.GITHUB.enabled) {
console.log('âŒ GitHub ìë™ ë¡œë“œê°€ ë¹„í™œì„±í™”ë¨');
showStatus('GitHub ìë™ ë¡œë“œê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¡œì»¬ íŒŒì¼ì„ í™•ì¸ ì¤‘...', 'info');
await tryLocalDatabase();
return;
}

if (CONFIG.GITHUB.username === 'YOUR_USERNAME' || CONFIG.GITHUB.repository === 'YOUR_REPOSITORY') {
console.log('âŒ GitHub ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ì–´ìˆìŒ');
showStatus('GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œì»¬ íŒŒì¼ì„ í™•ì¸ ì¤‘...', 'info');
await tryLocalDatabase();
return;
}

// GitHub Raw URL ìƒì„±
const baseUrl = `https://raw.githubusercontent.com/${CONFIG.GITHUB.username}/${CONFIG.GITHUB.repository}/${CONFIG.GITHUB.branch}/${CONFIG.GITHUB.dataFolder}`;
console.log('ğŸ”— GitHub Base URL:', baseUrl);

const defaultDbFiles = [
'ESSA_DATA',         // ë©”ì¸ ESSA ë°ì´í„°ë² ì´ìŠ¤
'ESSA_DATA.db',      // í™•ì¥ì í¬í•¨ ë²„ì „
'data.db',           // ê¸°ë³¸ íŒŒì¼ëª…
'database.db',       // ì¼ë°˜ì ì¸ íŒŒì¼ëª…
'price_data.db',     // ê°€ê²© ë°ì´í„°
'products.db',       // ì œí’ˆ ë°ì´í„°
'sample.db'          // ìƒ˜í”Œ ë°ì´í„°
];

// GitHubì—ì„œ íŒŒì¼ ë¡œë“œ ì‹œë„
for (const fileName of defaultDbFiles) {
try {
const githubUrl = `${baseUrl}/${fileName}`;
console.log(`ğŸ” ì‹œë„ ì¤‘: ${githubUrl}`);
showStatus(`GitHubì—ì„œ "${fileName}" ë¡œë“œ ì‹œë„ ì¤‘...`, 'info');

const response = await fetch(githubUrl);
console.log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);

if (response.ok) {
console.log(`âœ… ${fileName} ë¡œë“œ ì„±ê³µ!`);
const arrayBuffer = await response.arrayBuffer();
console.log(`ğŸ“¦ íŒŒì¼ í¬ê¸°: ${arrayBuffer.byteLength} bytes`);
await loadDatabase(arrayBuffer, fileName, true); // ìë™ ë¡œë“œ
showStatus(`GitHubì—ì„œ "${fileName}" ìë™ ë¡œë“œ ì™„ë£Œ!`, 'success');
return; // ì„±ê³µí•˜ë©´ ì¢…ë£Œ
} else {
console.log(`âŒ ${fileName} ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
}
} catch (error) {
console.log(`ğŸ’¥ GitHub ${fileName} ë¡œë“œ ì˜¤ë¥˜:`, error);
showStatus(`GitHub "${fileName}" ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'error');
}
}

// GitHub ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ íŒŒì¼ ì‹œë„
console.log('ğŸ”„ GitHub ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ íŒŒì¼ ì‹œë„');
showStatus('GitHubì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ íŒŒì¼ì„ í™•ì¸ ì¤‘...', 'info');
await tryLocalDatabase();
}

// ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹œë„
async function tryLocalDatabase() {
console.log('ğŸ”„ ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹œì‘');
const localDbFiles = [
'ESSA_DATA',         // ë©”ì¸ ESSA ë°ì´í„°ë² ì´ìŠ¤
'ESSA_DATA.db',      // í™•ì¥ì í¬í•¨ ë²„ì „
'data.db',
'database.db',
'price_data.db'
];

for (const fileName of localDbFiles) {
try {
console.log(`ğŸ” ë¡œì»¬ íŒŒì¼ ì‹œë„: ${fileName}`);
showStatus(`ë¡œì»¬ "${fileName}" ë¡œë“œ ì‹œë„ ì¤‘...`, 'info');

const response = await fetch(fileName);
console.log(`ğŸ“¡ ë¡œì»¬ ì‘ë‹µ: ${response.status} ${response.statusText}`);

if (response.ok) {
console.log(`âœ… ë¡œì»¬ ${fileName} ë¡œë“œ ì„±ê³µ!`);
const arrayBuffer = await response.arrayBuffer();
console.log(`ğŸ“¦ ë¡œì»¬ íŒŒì¼ í¬ê¸°: ${arrayBuffer.byteLength} bytes`);
await loadDatabase(arrayBuffer, fileName, true); // ìë™ ë¡œë“œ
showStatus(`ë¡œì»¬ "${fileName}" ìë™ ë¡œë“œ ì™„ë£Œ!`, 'success');
return;
} else {
console.log(`âŒ ë¡œì»¬ ${fileName} ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
}
} catch (error) {
console.log(`ğŸ’¥ ë¡œì»¬ ${fileName} ë¡œë“œ ì˜¤ë¥˜:`, error);
}
}

// ëª¨ë“  ìë™ ë¡œë“œ ì‹¤íŒ¨ ì‹œ
console.log('âŒ ëª¨ë“  ìë™ ë¡œë“œ ì‹¤íŒ¨');
showStatus('ìë™ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'info');
displayGitHubInstructions();
}

// GitHub ì„¤ì • ì•ˆë‚´ í‘œì‹œ
function displayGitHubInstructions() {
const currentConfig = CONFIG.GITHUB;
const isConfigured = currentConfig.username !== 'YOUR_USERNAME' && currentConfig.repository !== 'YOUR_REPOSITORY';

const instructionsHTML = `
<div class="github-instructions" style="margin-top: 15px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${isConfigured ? '#28a745' : '#007bff'};">
<h4 style="color: ${isConfigured ? '#28a745' : '#007bff'}; margin-bottom: 10px;">
${isConfigured ? 'âœ… GitHub ì„¤ì • ì™„ë£Œ' : 'ğŸ“‹ GitHub ìë™ ë¡œë“œ ì„¤ì • ë°©ë²•'}
</h4>

${isConfigured ? `
<div style="background: #d4edda; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
<strong>í˜„ì¬ ì„¤ì •:</strong><br>
â€¢ ì‚¬ìš©ì: <code>${currentConfig.username}</code><br>
â€¢ ë¦¬í¬ì§€í† ë¦¬: <code>${currentConfig.repository}</code><br>
â€¢ ë¸Œëœì¹˜: <code>${currentConfig.branch}</code><br>
â€¢ ë°ì´í„° í´ë”: <code>${currentConfig.dataFolder}</code><br>
â€¢ ì˜ˆìƒ URL: <code style="font-size: 11px;">https://raw.githubusercontent.com/${currentConfig.username}/${currentConfig.repository}/${currentConfig.branch}/${currentConfig.dataFolder}/ESSA_DATA</code>
</div>
<p style="color: #155724; font-weight: 600;">ìœ„ URLì— ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
` : `
<ol style="margin: 10px 0; padding-left: 20px; line-height: 1.6; font-size: 14px;">
<li><strong>GitHub ë¦¬í¬ì§€í† ë¦¬ ìƒì„±</strong>
   <ul style="margin: 5px 0; padding-left: 20px;">
   <li>GitHub.comì—ì„œ ìƒˆ ë¦¬í¬ì§€í† ë¦¬ ìƒì„±</li>
   <li>Publicìœ¼ë¡œ ì„¤ì • (Privateë„ ê°€ëŠ¥í•˜ì§€ë§Œ í† í° í•„ìš”)</li>
   </ul>
</li>
<li><strong>ë°ì´í„° í´ë” ë° íŒŒì¼ ì—…ë¡œë“œ</strong>
   <ul style="margin: 5px 0; padding-left: 20px;">
   <li>ë¦¬í¬ì§€í† ë¦¬ì— <code>data</code> í´ë” ìƒì„±</li>
   <li>SQLite íŒŒì¼ì„ <code>data/ESSA_DATA</code>ë¡œ ì—…ë¡œë“œ</li>
   </ul>
</li>
<li><strong>HTML íŒŒì¼ ì„¤ì • ìˆ˜ì •</strong>
<pre style="background: #e9ecef; padding: 10px; border-radius: 4px; margin: 8px 0; font-size: 12px; overflow-x: auto;">
GITHUB: {
  username: '${currentConfig.username === 'YOUR_USERNAME' ? 'ì‹¤ì œì‚¬ìš©ìëª…' : currentConfig.username}',
  repository: '${currentConfig.repository === 'YOUR_REPOSITORY' ? 'ì‹¤ì œë¦¬í¬ì§€í† ë¦¬ëª…' : currentConfig.repository}',
  branch: 'main',
  dataFolder: 'data',
  enabled: true
}
</pre>
</li>
<li><strong>íŒŒì¼ ì €ì¥ í›„ ìƒˆë¡œê³ ì¹¨</strong></li>
</ol>

<div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ffc107;">
<strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong><br>
â€¢ GitHub Raw URLì€ ìºì‹œê°€ ì ìš©ë˜ë¯€ë¡œ íŒŒì¼ ì—…ë°ì´íŠ¸ í›„ ë°˜ì˜ê¹Œì§€ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
â€¢ Private ë¦¬í¬ì§€í† ë¦¬ ì‚¬ìš© ì‹œ GitHub Personal Access Tokenì´ í•„ìš”í•©ë‹ˆë‹¤
</div>
`}

<div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 4px;">
<strong>ğŸ“ ê¶Œì¥ í´ë” êµ¬ì¡°:</strong>
<pre style="font-size: 11px; margin: 5px 0;">
your-repository/
â”œâ”€â”€ index.html
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ ESSA_DATA        â† ë©”ì¸ ESSA ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ data.db          â† ë°±ì—… ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ database.db      â† ì¶”ê°€ ë°ì´í„°ë² ì´ìŠ¤
â”‚   â””â”€â”€ sample.db        â† ìƒ˜í”Œ ë°ì´í„°
â””â”€â”€ README.md
</pre>
</div>
</div>
`;

const dbInfo = document.getElementById('dbInfo');
if (dbInfo) {
dbInfo.innerHTML = instructionsHTML;
dbInfo.style.display = 'block';
}
}

function handleFileUpload(file) {
if (!CONFIG.ALLOWED_EXTENSIONS.test(file.name)) {
showStatus('SQLite ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼(.db, .sqlite, .sqlite3)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
return;
}

showStatus('íŒŒì¼ì„ ì½ëŠ” ì¤‘...', 'info');
const reader = new FileReader();
reader.onload = e => loadDatabase(e.target.result, file.name, false); // ìˆ˜ë™ ì—…ë¡œë“œ
reader.onerror = () => showStatus('íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
reader.readAsArrayBuffer(file);
}

async function loadDatabase(arrayBuffer, fileName, isAutoLoad = true) {
try {
showStatus('SQL.js ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œ ì¤‘...', 'info');

if (typeof initSqlJs === 'undefined') {
await new Promise((resolve, reject) => {
const script = document.createElement('script');
script.src = `${CONFIG.SQLJSCDN}/sql-wasm.js`;
script.onload = resolve;
script.onerror = reject;
document.head.appendChild(script);
});
}

const SQL = await initSqlJs({
locateFile: file => `${CONFIG.SQLJSCDN}/${file}`
});

// ê³µìœ  DBì— ì €ì¥
state.db = new SQL.Database(new Uint8Array(arrayBuffer));
state.fileName = fileName;

// ë‘ íƒ­ ëª¨ë‘ ë¶„ì„
analyzeBothTables();

// ìë™ ë¡œë“œ ì„±ê³µ ì‹œì—ë§Œ ì—…ë¡œë“œ ì„¹ì…˜ ìˆ¨ê¹€
if (isAutoLoad) {
hideUploadSection();
}

} catch (error) {
showStatus('ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
}
}

// ì—…ë¡œë“œ ì„¹ì…˜ ìˆ¨ê¹€ í•¨ìˆ˜
function hideUploadSection() {
const uploadSection = document.querySelector('.common-upload-section');
if (uploadSection) {
// ë¨¼ì € "ìë™ ë¡œë“œë¨" ë©”ì‹œì§€ í‘œì‹œ
const uploadArea = uploadSection.querySelector('.upload-area');
if (uploadArea) {
uploadArea.innerHTML = `
<div style="color: #28a745; font-weight: 700;">
<i style="font-size: 24px;">âœ…</i>
<h3 style="color: #28a745; margin: 8px 0 4px 0;">ë°ì´í„°ë² ì´ìŠ¤ ìë™ ë¡œë“œ ì™„ë£Œ</h3>
<p style="color: #155724;">GitHubì—ì„œ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤</p>
</div>
`;
uploadArea.style.border = '2px solid #28a745';
uploadArea.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
uploadArea.style.cursor = 'default';
}

// 3ì´ˆ í›„ ìˆ¨ê¹€ ì²˜ë¦¬
setTimeout(() => {
uploadSection.style.transition = 'all 0.5s ease';
uploadSection.style.opacity = '0';
uploadSection.style.transform = 'translateY(-20px)';
uploadSection.style.maxHeight = '0';
uploadSection.style.padding = '0 20px';
uploadSection.style.marginBottom = '0';
uploadSection.style.overflow = 'hidden';

// ì™„ì „íˆ ìˆ¨ê¸°ê¸°
setTimeout(() => {
uploadSection.style.display = 'none';
}, 500);
}, 3000);

console.log('ğŸ“¦ ì—…ë¡œë“œ ì„¹ì…˜ ìˆ¨ê¹€ ì²˜ë¦¬ ì™„ë£Œ');
}
}

// ì—…ë¡œë“œ ì„¹ì…˜ ë‹¤ì‹œ ë³´ì´ê¸° í•¨ìˆ˜ (í•„ìš”ì‹œ ì‚¬ìš©)
function showUploadSection() {
const uploadSection = document.querySelector('.common-upload-section');
if (uploadSection) {
uploadSection.style.display = 'block';
uploadSection.style.opacity = '0';
uploadSection.style.transform = 'translateY(-20px)';
uploadSection.style.maxHeight = 'none';
uploadSection.style.padding = '20px';
uploadSection.style.marginBottom = '25px';
uploadSection.style.overflow = 'visible';

// ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë‚˜íƒ€ë‚´ê¸°
setTimeout(() => {
uploadSection.style.opacity = '1';
uploadSection.style.transform = 'translateY(0)';
}, 50);

console.log('ğŸ“¦ ì—…ë¡œë“œ ì„¹ì…˜ í‘œì‹œ ì²˜ë¦¬ ì™„ë£Œ');
}
}

function analyzeBothTables() {
try {
let essaSuccess = false;
let aceSuccess = false;

// ESSA í…Œì´ë¸” ë¶„ì„
const essaTable = CONFIG.TABLE_CONFIG.essa;
const essaCheck = state.db.exec(`SELECT name FROM sqlite_master WHERE type='table' AND name='${essaTable}'`);
if (essaCheck.length && essaCheck[0].values.length) {
const essaColumns = state.db.exec(`PRAGMA table_info(${essaTable})`);
state.essa.tableInfo = {
name: essaTable,
columns: essaColumns[0].values.map(col => col[1])
};
const essaRowCount = state.db.exec(`SELECT COUNT(*) FROM ${essaTable}`);
const essaCount = essaRowCount[0].values[0][0];
populateAllEssaOptions();
document.getElementById('searchForm-essa').style.display = 'grid';
essaSuccess = true;
console.log(`ESSA í…Œì´ë¸” ë¡œë“œ ì™„ë£Œ: ${essaCount}ê°œ ë ˆì½”ë“œ`);
}

// ACE í…Œì´ë¸” ë¶„ì„
const aceTable = CONFIG.TABLE_CONFIG.ace;
const aceCheck = state.db.exec(`SELECT name FROM sqlite_master WHERE type='table' AND name='${aceTable}'`);
if (aceCheck.length && aceCheck[0].values.length) {
const aceColumns = state.db.exec(`PRAGMA table_info(${aceTable})`);
state.ace.tableInfo = {
name: aceTable,
columns: aceColumns[0].values.map(col => col[1])
};
const aceRowCount = state.db.exec(`SELECT COUNT(*) FROM ${aceTable}`);
const aceCount = aceRowCount[0].values[0][0];
populateAllOptions('ace');
document.getElementById('searchForm-ace').style.display = 'grid';
aceSuccess = true;
console.log(`ACE í…Œì´ë¸” ë¡œë“œ ì™„ë£Œ: ${aceCount}ê°œ ë ˆì½”ë“œ`);
}

// ê²°ê³¼ ë©”ì‹œì§€
if (essaSuccess && aceSuccess) {
showStatus(`"${state.fileName}" ë¡œë“œ ì™„ë£Œ! ESSAì™€ ACE íƒ­ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.`, 'success');
displayDatabaseInfo();
} else if (essaSuccess) {
showStatus(`"${state.fileName}" ë¡œë“œ ì™„ë£Œ! ESSA íƒ­ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.`, 'success');
displayDatabaseInfo();
} else if (aceSuccess) {
showStatus(`"${state.fileName}" ë¡œë“œ ì™„ë£Œ! ACE íƒ­ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.`, 'success');
displayDatabaseInfo();
} else {
showStatus('ë°ì´í„°ë² ì´ìŠ¤ì— DATA ë˜ëŠ” DATA_1 í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
}

} catch (error) {
showStatus('ë°ì´í„°ë² ì´ìŠ¤ ë¶„ì„ ì˜¤ë¥˜: ' + error.message, 'error');
}
}

function displayDatabaseInfo() {
let infoHTML = '<h4>ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´</h4>';
infoHTML += `<p>íŒŒì¼ëª…: ${state.fileName}</p>`;
if (state.essa.tableInfo) {
const essaCount = state.db.exec(`SELECT COUNT(*) FROM ${state.essa.tableInfo.name}`);
infoHTML += `<p>ESSA í…Œì´ë¸”: ${state.essa.tableInfo.name} (${essaCount[0].values[0][0]}ê°œ ë ˆì½”ë“œ)</p>`;
}
if (state.ace.tableInfo) {
const aceCount = state.db.exec(`SELECT COUNT(*) FROM ${state.ace.tableInfo.name}`);
infoHTML += `<p>ACE í…Œì´ë¸”: ${state.ace.tableInfo.name} (${aceCount[0].values[0][0]}ê°œ ë ˆì½”ë“œ)</p>`;
}
document.getElementById('dbInfo').innerHTML = infoHTML;
document.getElementById('dbInfo').style.display = 'block';
}

function showStatus(message, type) {
document.getElementById('statusMessage').innerHTML = 
`<div class="status-message ${type}">${message}</div>`;
}

// ê²€ìƒ‰ í•¨ìˆ˜
function searchProducts(tabName) {
if (!state.db || !state[tabName].tableInfo) {
showStatus('ë¨¼ì € ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
return;
}

document.getElementById(`loading-${tabName}`).style.display = 'block';
document.getElementById(`results-container-${tabName}`).innerHTML = '';

setTimeout(() => {
try {
const searchParams = {};
const fieldMapping = CONFIG.FIELD_MAPPING[tabName];
Object.keys(fieldMapping).forEach(key => {
const element = document.getElementById(`${tabName}_${key}`);
if (element) {
const value = (element.value || '').trim();
if (value) searchParams[key] = value;
}
});

const products = performSearch(searchParams, tabName);
state[tabName].currentProducts = products;
state[tabName].currentSort = 'none';
displayResults(products, tabName);
} catch (error) {
document.getElementById(`results-container-${tabName}`).innerHTML = 
`<div class="no-results">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
} finally {
document.getElementById(`loading-${tabName}`).style.display = 'none';
}
}, 100);
}

function performSearch(searchParams, tabName) {
let query = `SELECT * FROM ${state[tabName].tableInfo.name} WHERE 1=1`;
const params = [];

if (tabName === 'essa') {
Object.entries(searchParams).forEach(([key, value]) => {
const matchedCol = findMatchingColumn(key, tabName);
if (matchedCol) {
const actualCol = getActualColumnName(matchedCol, tabName);
const safeCol = getSafeColumnName(actualCol);
query += ` AND ${safeCol} = ?`;
params.push(value);
}
});
} else if (tabName === 'ace') {
const frameValue = searchParams.frame;
const typeValue = searchParams.type;
const mattressValue = searchParams.mattress;
const foundationValue = searchParams.foundation;
const relatedItemsValue = searchParams.related_items;
const categoryValue = searchParams.category;
const sizeValue = searchParams.size;
const nightstandValue = searchParams.nightstand;
const sideboardValue = searchParams.sideboard;
const furnitureValue = searchParams.furniture;

let complexCondition = '';
let complexParams = [];

let group1Conditions = [];
let group1Params = [];

if (frameValue && typeValue) {
const frameCol = findMatchingColumn('frame', tabName);
const typeCol = findMatchingColumn('type', tabName);
if (frameCol && typeCol) {
const actualFrameCol = getActualColumnName(frameCol, tabName);
const actualTypeCol = getActualColumnName(typeCol, tabName);
const safeFrameCol = getSafeColumnName(actualFrameCol);
const safeTypeCol = getSafeColumnName(actualTypeCol);
group1Conditions.push(`(${safeFrameCol} = ? AND ${safeTypeCol} = ?)`);
group1Params.push(frameValue, typeValue);
}
} else if (frameValue) {
const frameCol = findMatchingColumn('frame', tabName);
if (frameCol) {
const actualFrameCol = getActualColumnName(frameCol, tabName);
const safeFrameCol = getSafeColumnName(actualFrameCol);
group1Conditions.push(`(${safeFrameCol} = ?)`);
group1Params.push(frameValue);
}
}

if (mattressValue) {
const mattressCol = findMatchingColumn('mattress', tabName);
if (mattressCol) {
const actualMattressCol = getActualColumnName(mattressCol, tabName);
const safeMattressCol = getSafeColumnName(actualMattressCol);
group1Conditions.push(`(${safeMattressCol} = ?)`);
group1Params.push(mattressValue);
}
}

if (foundationValue) {
const foundationCol = findMatchingColumn('foundation', tabName);
if (foundationCol) {
const actualFoundationCol = getActualColumnName(foundationCol, tabName);
const safeFoundationCol = getSafeColumnName(actualFoundationCol);
group1Conditions.push(`(${safeFoundationCol} = ?)`);
group1Params.push(foundationValue);
}
}

if (relatedItemsValue) {
const relatedItemsCol = findMatchingColumn('related_items', tabName);
if (relatedItemsCol) {
const actualRelatedItemsCol = getActualColumnName(relatedItemsCol, tabName);
const safeRelatedItemsCol = getSafeColumnName(actualRelatedItemsCol);
group1Conditions.push(`(${safeRelatedItemsCol} = ?)`);
group1Params.push(relatedItemsValue);
}
}

if (categoryValue) {
const categoryCol = findMatchingColumn('category', tabName);
if (categoryCol) {
const actualCategoryCol = getActualColumnName(categoryCol, tabName);
const safeCategoryCol = getSafeColumnName(actualCategoryCol);
group1Conditions.push(`(${safeCategoryCol} = ?)`);
group1Params.push(categoryValue);
}
}

if (group1Conditions.length > 0) {
let group1Query = '';
if (group1Conditions.length === 1) {
group1Query = group1Conditions[0];
} else {
group1Query = `(${group1Conditions.join(' OR ')})`;
}

if (sizeValue) {
const sizeCol = findMatchingColumn('size', tabName);
if (sizeCol) {
const actualSizeCol = getActualColumnName(sizeCol, tabName);
const safeSizeCol = getSafeColumnName(actualSizeCol);
group1Query = `(${group1Query} AND ${safeSizeCol} = ?)`;
group1Params.push(sizeValue);
}
}

complexCondition = group1Query;
complexParams = group1Params;
}

let group2Conditions = [];
let group2Params = [];

if (nightstandValue) {
const nightstandCol = findMatchingColumn('nightstand', tabName);
if (nightstandCol) {
const actualNightstandCol = getActualColumnName(nightstandCol, tabName);
const safeNightstandCol = getSafeColumnName(actualNightstandCol);
group2Conditions.push(`(${safeNightstandCol} = ?)`);
group2Params.push(nightstandValue);
}
}

if (sideboardValue) {
const sideboardCol = findMatchingColumn('sideboard', tabName);
if (sideboardCol) {
const actualSideboardCol = getActualColumnName(sideboardCol, tabName);
const safeSideboardCol = getSafeColumnName(actualSideboardCol);
group2Conditions.push(`(${safeSideboardCol} = ?)`);
group2Params.push(sideboardValue);
}
}

if (furnitureValue) {
const furnitureCol = findMatchingColumn('furniture', tabName);
if (furnitureCol) {
const actualFurnitureCol = getActualColumnName(furnitureCol, tabName);
const safeFurnitureCol = getSafeColumnName(actualFurnitureCol);
group2Conditions.push(`(${safeFurnitureCol} = ?)`);
group2Params.push(furnitureValue);
}
}

if (group2Conditions.length > 0) {
let group2Query = '';
if (group2Conditions.length === 1) {
group2Query = group2Conditions[0];
} else {
group2Query = `(${group2Conditions.join(' OR ')})`;
}

if (complexCondition) {
complexCondition = `(${complexCondition} OR ${group2Query})`;
complexParams = [...complexParams, ...group2Params];
} else {
complexCondition = group2Query;
complexParams = group2Params;
}
}

if (complexCondition) {
query += ` AND ${complexCondition}`;
params.push(...complexParams);
}
}

try {
const stmt = state.db.prepare(query);
stmt.bind(params);
const products = [];
let totalAmount = 0;

while (stmt.step()) {
const product = stmt.getAsObject();
products.push(product);

// ëª¨ë“  íƒ­ì—ì„œ ì´í•©ê³„ ê³„ì‚°
const price = getPriceValue(product);
const quantity = 1; // ê¸°ë³¸ ìˆ˜ëŸ‰
totalAmount += price * quantity;
}
stmt.free();

// íƒ­ë³„ ì´í•©ê³„ ì €ì¥
state[tabName].totalAmount = totalAmount;

return products;
} catch (error) {
console.error('Search query error:', error, query, params);
return [];
}
}

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function findMatchingColumn(fieldKey, tabName) {
const fieldMapping = CONFIG.FIELD_MAPPING[tabName];
if (!fieldMapping[fieldKey]) {
return null;
}

const possibleNames = fieldMapping[fieldKey];
let matched = possibleNames.find(name => 
state[tabName].tableInfo.columns.some(col => col.toUpperCase() === name.toUpperCase())
);

if (!matched && fieldKey === 'size') {
matched = state[tabName].tableInfo.columns.find(col => 
col.toUpperCase().includes('SIZE') || col.includes('ì‚¬ì´ì¦ˆ')
);
}

return matched;
}

function getActualColumnName(matchedCol, tabName) {
const actual = state[tabName].tableInfo.columns.find(col => 
col.toUpperCase() === matchedCol.toUpperCase()
);

if (!actual) {
return state[tabName].tableInfo.columns.find(col => 
col.includes(matchedCol) || matchedCol.includes(col)
) || matchedCol;
}

return actual;
}

function getSafeColumnName(colName) {
return /[ -]/.test(colName) ? `[${colName}]` : colName;
}

function getPriceValue(product) {
const priceKeys = ['ê¸ˆì•¡', 'íŒë§¤ê°€', 'PRICE', 'SALE_PRICE', 'ê°€ê²©', 'PRICE_AMOUNT', 'AMOUNT'];
for (const key of priceKeys) {
const foundKey = Object.keys(product).find(k => k.toUpperCase() === key.toUpperCase());
if (foundKey) {
const value = product[foundKey];
if (value === undefined || value === null || value === '') {
continue;
}

let num;
if (typeof value === 'string') {
const cleanValue = value.replace(/[â‚©,ì›\\s]/g, '');
num = parseInt(cleanValue);
} else if (typeof value === 'number') {
num = value;
} else {
continue;
}

if (!isNaN(num) && num !== 0) {
return num;
}
}
}
return 0;
}

function formatPrice(price) {
if (!price) return "0";
const num = typeof price === 'string' ? parseInt(price.replace(/,/g, '')) : price;
return isNaN(num) ? "0" : num.toLocaleString('ko-KR');
}

function findColumnValue(product, possibleKeys) {
for (const key of possibleKeys) {
const foundKey = Object.keys(product).find(k => k.toUpperCase() === key.toUpperCase());
if (foundKey && product[foundKey] !== undefined && product[foundKey] !== null) {
return product[foundKey];
}
}
return '-';
}

function normalizeSizeValue(size) {
if (!size) return null;
let normalized = size.toString().trim();

if (normalized.match(/^\d+\s*(ì¸|äºº|IN)$/i)) {
const num = normalized.match(/^\d+/)[0];
return `${num}ì¸`;
}

if (normalized.match(/^[A-Z]{1,3}$/i)) {
return normalized.toUpperCase();
}

return normalized;
}

function compareSizeValues(a, b) {
const numA = a.match(/\d+/)?.[0] || 0;
const numB = b.match(/\d+/)?.[0] || 0;

if (numA !== numB) {
return parseInt(numA) - parseInt(numB);
}

return a.localeCompare(b);
}

// ESSA ì˜µì…˜ ì±„ìš°ê¸° í•¨ìˆ˜ë“¤
function populateAllEssaOptions() {
const fieldMapping = CONFIG.FIELD_MAPPING.essa;
Object.keys(fieldMapping).forEach(fieldKey => {
const matchedCol = findMatchingColumn(fieldKey, 'essa');
if (matchedCol) {
const actualCol = getActualColumnName(matchedCol, 'essa');
const safeCol = getSafeColumnName(actualCol);

try {
const query = `SELECT DISTINCT ${safeCol} FROM ${state.essa.tableInfo.name} 
WHERE ${safeCol} IS NOT NULL AND TRIM(${safeCol}) != '' 
ORDER BY ${safeCol}`;
const result = state.db.exec(query);

const selectElement = document.getElementById(`essa_${fieldKey}`);
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
if (fieldKey === 'size') {
const normalized = normalizeSizeValue(value.toString().trim());
if (normalized) {
uniqueValues.push(normalized);
}
} else {
uniqueValues.push(value.toString().trim());
}
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort((a, b) => {
if (fieldKey === 'size') {
return compareSizeValues(a, b);
}
return a.localeCompare(b);
});

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
selectElement.appendChild(option);
});
}
} catch (error) {
console.error(`Error populating essa ${fieldKey}:`, error);
}
}
});
}

function updateEssaDependentOptions(changedField) {
if (!state.db || !state.essa.tableInfo) return;

const pNameValue = document.getElementById('essa_p_name').value;
const sizeValue = document.getElementById('essa_size').value;
const materialValue = document.getElementById('essa_material').value;

if (pNameValue) {
updateEssaOptionsByProductName(pNameValue, sizeValue, materialValue, changedField);
} else if (sizeValue) {
updateEssaOptionsBySize(sizeValue, materialValue, changedField);
} else if (materialValue) {
updateEssaOptionsByMaterial(materialValue, changedField);
} else {
resetEssaDependentOptions();
}
}

function updateEssaOptionsByProductName(productName, currentSize, currentMaterial, changedField) {
const pNameCol = findMatchingColumn('p_name', 'essa');
if (!pNameCol) return;

const actualPNameCol = getActualColumnName(pNameCol, 'essa');
const safePNameCol = getSafeColumnName(actualPNameCol);

const dependentFields = ['size', 'size_option', 'material', 'fabric', 'function', 'stool', 'style', 'leather_option', 'event_product'];

dependentFields.forEach(fieldKey => {
if (changedField === fieldKey && (fieldKey === 'size' || fieldKey === 'material')) {
return;
}

const fieldCol = findMatchingColumn(fieldKey, 'essa');
if (!fieldCol) return;

const actualFieldCol = getActualColumnName(fieldCol, 'essa');
const safeFieldCol = getSafeColumnName(actualFieldCol);

try {
let whereClause = `${safePNameCol} = ?`;
const params = [productName];

if (fieldKey !== 'size' && currentSize) {
const sizeCol = findMatchingColumn('size', 'essa');
if (sizeCol) {
const actualSizeCol = getActualColumnName(sizeCol, 'essa');
const safeSizeCol = getSafeColumnName(actualSizeCol);
whereClause += ` AND ${safeSizeCol} = ?`;
params.push(currentSize);
}
}

if (fieldKey === 'fabric' && currentMaterial) {
const materialCol = findMatchingColumn('material', 'essa');
if (materialCol) {
const actualMaterialCol = getActualColumnName(materialCol, 'essa');
const safeMaterialCol = getSafeColumnName(actualMaterialCol);
whereClause += ` AND ${safeMaterialCol} = ?`;
params.push(currentMaterial);
}
}

const query = `SELECT DISTINCT ${safeFieldCol} FROM ${state.essa.tableInfo.name} 
WHERE ${whereClause} AND ${safeFieldCol} IS NOT NULL AND TRIM(${safeFieldCol}) != '' 
ORDER BY ${safeFieldCol}`;
const result = state.db.exec(query, params);

const selectElement = document.getElementById(`essa_${fieldKey}`);
const currentValue = selectElement.value;

if (changedField !== fieldKey) {
selectElement.innerHTML = '<option value="">ì „ì²´</option>';
} else {
selectElement.innerHTML = '<option value="">ì „ì²´</option>';
}

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
if (fieldKey === 'size') {
const normalized = normalizeSizeValue(value.toString().trim());
if (normalized) {
uniqueValues.push(normalized);
}
} else {
uniqueValues.push(value.toString().trim());
}
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort((a, b) => {
if (fieldKey === 'size') {
return compareSizeValues(a, b);
}
return a.localeCompare(b);
});

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (changedField !== fieldKey && value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});
}
} catch (error) {
console.error(`Error updating ${fieldKey}:`, error);
}
});
}

function updateEssaOptionsBySize(sizeValue, currentMaterial, changedField) {
const sizeCol = findMatchingColumn('size', 'essa');
if (!sizeCol) return;

const actualSizeCol = getActualColumnName(sizeCol, 'essa');
const safeSizeCol = getSafeColumnName(actualSizeCol);

const dependentFields = ['p_name', 'size_option', 'material', 'fabric', 'function', 'stool', 'style', 'leather_option', 'event_product'];

dependentFields.forEach(fieldKey => {
if (changedField === fieldKey) return;

const fieldCol = findMatchingColumn(fieldKey, 'essa');
if (!fieldCol) return;

const actualFieldCol = getActualColumnName(fieldCol, 'essa');
const safeFieldCol = getSafeColumnName(actualFieldCol);

try {
let whereClause = `${safeSizeCol} = ?`;
const params = [sizeValue];

if (fieldKey === 'fabric' && currentMaterial) {
const materialCol = findMatchingColumn('material', 'essa');
if (materialCol) {
const actualMaterialCol = getActualColumnName(materialCol, 'essa');
const safeMaterialCol = getSafeColumnName(actualMaterialCol);
whereClause += ` AND ${safeMaterialCol} = ?`;
params.push(currentMaterial);
}
}

const query = `SELECT DISTINCT ${safeFieldCol} FROM ${state.essa.tableInfo.name} 
WHERE ${whereClause} AND ${safeFieldCol} IS NOT NULL AND TRIM(${safeFieldCol}) != '' 
ORDER BY ${safeFieldCol}`;
const result = state.db.exec(query, params);

const selectElement = document.getElementById(`essa_${fieldKey}`);
const currentValue = selectElement.value;
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
uniqueValues.push(value.toString().trim());
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort();

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});
}
} catch (error) {
console.error(`Error updating ${fieldKey}:`, error);
}
});
}

function updateEssaOptionsByMaterial(materialValue, changedField) {
const materialCol = findMatchingColumn('material', 'essa');
if (!materialCol) return;

const actualMaterialCol = getActualColumnName(materialCol, 'essa');
const safeMaterialCol = getSafeColumnName(actualMaterialCol);

if (changedField !== 'fabric') {
const fabricCol = findMatchingColumn('fabric', 'essa');
if (fabricCol) {
const actualFabricCol = getActualColumnName(fabricCol, 'essa');
const safeFabricCol = getSafeColumnName(actualFabricCol);

try {
const query = `SELECT DISTINCT ${safeFabricCol} FROM ${state.essa.tableInfo.name} 
WHERE ${safeMaterialCol} = ? AND ${safeFabricCol} IS NOT NULL AND TRIM(${safeFabricCol}) != '' 
ORDER BY ${safeFabricCol}`;
const result = state.db.exec(query, [materialValue]);

const selectElement = document.getElementById('essa_fabric');
const currentValue = selectElement.value;
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
uniqueValues.push(value.toString().trim());
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort();

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});
}
} catch (error) {
console.error('Error updating fabric:', error);
}
}
}
}

function resetEssaDependentOptions() {
const fields = ['p_name', 'size', 'size_option', 'material', 'fabric', 'function', 'stool', 'style', 'leather_option', 'event_product'];
fields.forEach(fieldKey => {
const selectElement = document.getElementById(`essa_${fieldKey}`);
selectElement.innerHTML = '<option value="">ì „ì²´</option>';
});

if (state.db && state.essa.tableInfo) {
populateAllEssaOptions();
}
}

// ACE ì˜µì…˜ ì±„ìš°ê¸° í•¨ìˆ˜ë“¤
function populateAllOptions(tabName) {
const fieldMapping = CONFIG.FIELD_MAPPING[tabName];
Object.keys(fieldMapping).forEach(fieldKey => {
if (fieldKey !== 'type' && fieldKey !== 'size') {
const matchedCol = findMatchingColumn(fieldKey, tabName);
if (matchedCol) {
const actualCol = getActualColumnName(matchedCol, tabName);
const safeCol = getSafeColumnName(actualCol);

try {
const query = `SELECT DISTINCT ${safeCol} FROM ${state[tabName].tableInfo.name} 
WHERE ${safeCol} IS NOT NULL AND ${safeCol} != '' 
ORDER BY ${safeCol}`;
const result = state.db.exec(query);

// ëª¨ë“  í•„ë“œë¥¼ selectë¡œ ì²˜ë¦¬ (ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í–¥ìƒ)
const selectElement = document.getElementById(`${tabName}_${fieldKey}`);
const currentValue = selectElement.value;
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
uniqueValues.push(value.toString().trim());
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort();

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});
}
} catch (error) {
console.error(`Error populating ${fieldKey}:`, error);
}
}
}
});

populateSizeOptions(tabName);
}

function populateSizeOptions(tabName) {
const sizeSelect = document.getElementById(`${tabName}_size`);
sizeSelect.innerHTML = '<option value="">ì „ì²´</option>';

if (!state.db || !state[tabName].tableInfo) return;

const matchedCol = findMatchingColumn('size', tabName);
if (matchedCol) {
const actualCol = getActualColumnName(matchedCol, tabName);
const safeCol = getSafeColumnName(actualCol);

try {
const query = `SELECT DISTINCT ${safeCol} FROM ${state[tabName].tableInfo.name} 
WHERE ${safeCol} IS NOT NULL AND TRIM(${safeCol}) != '' 
ORDER BY ${safeCol}`;
const result = state.db.exec(query);

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
const normalized = normalizeSizeValue(value.toString().trim());
if (normalized) {
uniqueValues.push(normalized);
}
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort(compareSizeValues);

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
sizeSelect.appendChild(option);
});
}
} catch (error) {
console.error(`Error populating size for ${tabName}:`, error);
}
}
}

function updateDependentOptions(tabName) {
if (!state.db || !state[tabName].tableInfo) return;

const frameElement = document.getElementById(`${tabName}_frame`);
const mattressElement = document.getElementById(`${tabName}_mattress`);

// ì•ˆì „í•œ ê°’ ê°€ì ¸ì˜¤ê¸° (ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í–¥ìƒ)
const frameValue = frameElement ? (frameElement.value || '').trim() : '';
const mattressValue = mattressElement ? (mattressElement.value || '').trim() : '';

if (frameValue) {
updateTypeOptions(tabName, frameValue);
updateSizeOptionsByFrame(tabName, frameValue);
} else if (mattressValue) {
updateSizeOptionsByMattress(tabName, mattressValue);
} else {
resetDependentOptions(tabName);
}
}

function updateTypeOptions(tabName, frameValue) {
const frameCol = findMatchingColumn('frame', tabName);
const typeCol = findMatchingColumn('type', tabName);
if (!frameCol || !typeCol) return;

const actualFrameCol = getActualColumnName(frameCol, tabName);
const actualTypeCol = getActualColumnName(typeCol, tabName);
const safeFrameCol = getSafeColumnName(actualFrameCol);
const safeTypeCol = getSafeColumnName(actualTypeCol);

try {
const query = `SELECT DISTINCT ${safeTypeCol} FROM ${state[tabName].tableInfo.name} 
WHERE ${safeFrameCol} = ? AND ${safeTypeCol} IS NOT NULL AND ${safeTypeCol} != '' 
ORDER BY ${safeTypeCol}`;
const result = state.db.exec(query, [frameValue]);

const selectElement = document.getElementById(`${tabName}_type`);
const currentValue = selectElement.value;
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
uniqueValues.push(value.toString().trim());
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort();

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});

const fieldNote = selectElement.parentNode.querySelector('.field-note');
if (fieldNote) {
fieldNote.textContent = `í”„ë ˆì„ ì„ íƒì‹œ í•´ë‹¹ íƒ€ì… í‘œì‹œ (${sortedUniqueValues.length}ê°œ)`;
}
} else {
const fieldNote = selectElement.parentNode.querySelector('.field-note');
if (fieldNote) {
fieldNote.textContent = 'í•´ë‹¹ í”„ë ˆì„ì— ë§ëŠ” íƒ€ì…ì´ ì—†ìŠµë‹ˆë‹¤';
}
}
} catch (error) {
console.error('Error updating type options:', error);
}
}

function updateSizeOptionsByFrame(tabName, frameValue) {
const frameCol = findMatchingColumn('frame', tabName);
const sizeCol = findMatchingColumn('size', tabName);
if (!frameCol || !sizeCol) return;

const actualFrameCol = getActualColumnName(frameCol, tabName);
const actualSizeCol = getActualColumnName(sizeCol, tabName);
const safeFrameCol = getSafeColumnName(actualFrameCol);
const safeSizeCol = getSafeColumnName(actualSizeCol);

try {
const query = `SELECT DISTINCT ${safeSizeCol} FROM ${state[tabName].tableInfo.name} 
WHERE ${safeFrameCol} = ? AND ${safeSizeCol} IS NOT NULL AND ${safeSizeCol} != '' 
ORDER BY ${safeSizeCol}`;
const result = state.db.exec(query, [frameValue]);

const selectElement = document.getElementById(`${tabName}_size`);
const currentValue = selectElement.value;
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
uniqueValues.push(value.toString().trim());
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort();

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});

const fieldNote = selectElement.parentNode.querySelector('.field-note');
if (fieldNote) {
fieldNote.textContent = `í”„ë ˆì„ ì„ íƒì‹œ í•´ë‹¹ ì‚¬ì´ì¦ˆ í‘œì‹œ (${sortedUniqueValues.length}ê°œ)`;
}
} else {
const fieldNote = selectElement.parentNode.querySelector('.field-note');
if (fieldNote) {
fieldNote.textContent = 'í•´ë‹¹ í”„ë ˆì„ì— ë§ëŠ” ì‚¬ì´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤';
}
}
} catch (error) {
console.error('Error updating size options by frame:', error);
}
}

function updateSizeOptionsByMattress(tabName, mattressValue) {
const mattressCol = findMatchingColumn('mattress', tabName);
const sizeCol = findMatchingColumn('size', tabName);
if (!mattressCol || !sizeCol) return;

const actualMattressCol = getActualColumnName(mattressCol, tabName);
const actualSizeCol = getActualColumnName(sizeCol, tabName);
const safeMattressCol = getSafeColumnName(actualMattressCol);
const safeSizeCol = getSafeColumnName(actualSizeCol);

try {
const query = `SELECT DISTINCT ${safeSizeCol} FROM ${state[tabName].tableInfo.name} 
WHERE ${safeMattressCol} = ? AND ${safeSizeCol} IS NOT NULL AND ${safeSizeCol} != '' 
ORDER BY ${safeSizeCol}`;
const result = state.db.exec(query, [mattressValue]);

const selectElement = document.getElementById(`${tabName}_size`);
const currentValue = selectElement.value;
selectElement.innerHTML = '<option value="">ì „ì²´</option>';

if (result.length > 0 && result[0].values.length > 0) {
const uniqueValues = [];
result[0].values.forEach(row => {
const value = row[0];
if (value && value.toString().trim() !== '') {
uniqueValues.push(value.toString().trim());
}
});

const sortedUniqueValues = [...new Set(uniqueValues)].sort();

sortedUniqueValues.forEach(value => {
const option = document.createElement('option');
option.value = value;
option.textContent = value;
if (value === currentValue) {
option.selected = true;
}
selectElement.appendChild(option);
});

const fieldNote = selectElement.parentNode.querySelector('.field-note');
if (fieldNote) {
fieldNote.textContent = `ë§¤íŠ¸ë¦¬ìŠ¤ ì„ íƒì‹œ í•´ë‹¹ ì‚¬ì´ì¦ˆ í‘œì‹œ (${sortedUniqueValues.length}ê°œ)`;
}
} else {
const fieldNote = selectElement.parentNode.querySelector('.field-note');
if (fieldNote) {
fieldNote.textContent = 'í•´ë‹¹ ë§¤íŠ¸ë¦¬ìŠ¤ì— ë§ëŠ” ì‚¬ì´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤';
}
}
} catch (error) {
console.error('Error updating size options by mattress:', error);
}
}

function resetDependentOptions(tabName) {
const typeSelect = document.getElementById(`${tabName}_type`);
typeSelect.innerHTML = '<option value="">ì „ì²´</option>';
const typeFieldNote = typeSelect.parentNode.querySelector('.field-note');
if (typeFieldNote) {
typeFieldNote.textContent = 'í”„ë ˆì„ ì„ íƒ ì‹œ ì—°ë™ë¨';
}

const sizeSelect = document.getElementById(`${tabName}_size`);
sizeSelect.innerHTML = '<option value="">ì „ì²´</option>';
const sizeFieldNote = sizeSelect.parentNode.querySelector('.field-note');
if (sizeFieldNote) {
sizeFieldNote.textContent = 'í”„ë ˆì„/ë§¤íŠ¸ë¦¬ìŠ¤ ì„ íƒ ì‹œ ì—°ë™ë¨';
}

populateAllOptions(tabName);
}

// ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
function displayResults(products, tabName) {
if (products.length === 0) {
document.getElementById(`results-container-${tabName}`).innerHTML = 
'<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
return;
}

let sortHTML = `
<div class="sort-controls">
<div style="display: flex; align-items: center; gap: 20px;">
${tabName === 'essa' && window.innerWidth > 768 ? `
<div style="display: flex; align-items: center; gap: 15px;">
<div style="display: flex; align-items: center; gap: 6px;">
<label for="essa-amount-discount" style="font-size: 14px; color: #2c3e50; font-weight: 700;">ê¸ˆì•¡í• ì¸:</label>
<input type="text" id="essa-amount-discount" class="discount-input-pc" value="0" onchange="applyEssaDiscount()" oninput="formatAmountInput(this)" onfocus="selectAllOnFocus(this)" style="width: 120px; padding: 6px 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; font-weight: 600; text-align: right;">
<span style="font-size: 14px; font-weight: 700; color: #2c3e50;">ì›</span>
</div>
<div style="display: flex; align-items: center; gap: 6px;">
<label for="essa-discount-rate" style="font-size: 14px; color: #2c3e50; font-weight: 700;">í• ì¸ìœ¨:</label>
<input type="number" id="essa-discount-rate" class="regional-discount-input-pc" value="0" min="0" max="100" step="1" onchange="applyEssaDiscount()" oninput="applyEssaDiscount()" style="width: 60px; padding: 6px 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; font-weight: 600; text-align: center;">
<span style="font-size: 14px; font-weight: 700; color: #2c3e50;">%</span>
</div>
</div>
` : ''}
<div style="display: flex; align-items: center; gap: 8px;">
<label for="sortSelect-${tabName}">ì •ë ¬:</label>
<select id="sortSelect-${tabName}" onchange="handleSort(this.value, '${tabName}')">
<option value="none" ${state[tabName].currentSort === 'none' ? 'selected' : ''}>ê¸°ë³¸</option>
<option value="asc" ${state[tabName].currentSort === 'asc' ? 'selected' : ''}>ê°€ê²© ë‚®ì€ìˆœ</option>
<option value="desc" ${state[tabName].currentSort === 'desc' ? 'selected' : ''}>ê°€ê²© ë†’ì€ìˆœ</option>
</select>
</div>
</div>
</div>`;

const displayColumns = CONFIG.DISPLAY_COLUMNS[tabName];
let tableHTML = '<table><thead><tr>';

displayColumns.forEach(col => {
tableHTML += `<th>${col.label}</th>`;
});
tableHTML += '</tr></thead><tbody>';

products.forEach((product, index) => {
tableHTML += '<tr>';
displayColumns.forEach(col => {
let value = findColumnValue(product, col.keys) || '-';

if (col.label === 'ìˆ˜ëŸ‰' && tabName === 'ace') {
// ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ
value = `<input type="number" class="quantity-input" value="1" min="1" max="999" 
onchange="updateQuantity(${index}, this.value, '${tabName}')" 
oninput="updateQuantity(${index}, this.value, '${tabName}')">`;
} else if (col.label === 'íŒë§¤ê°€') {
const originalPrice = getPriceValue(product);
const quantity = 1; // ê¸°ë³¸ ìˆ˜ëŸ‰
const totalPrice = originalPrice * quantity;

if (tabName === 'ace') {
value = `<span class="total-price" data-original="${originalPrice}" data-index="${index}">${formatPrice(totalPrice)}ì›</span>`;
} else {
value = formatPrice(value) + 'ì›';
}
} else if (col.label === 'í–‰ì‚¬ê°€' && tabName === 'essa') {
// ESSA íƒ­ í–‰ì‚¬ê°€: (íŒë§¤ê°€ - ê¸ˆì•¡í• ì¸) * (1-í• ì¸ìœ¨)
const originalPrice = getPriceValue(product);
value = `<span class="event-price" data-original="${originalPrice}" data-index="${index}">${formatPrice(originalPrice)}ì›</span>`;
}

const priceClass = (col.label === 'íŒë§¤ê°€' || col.label === 'í–‰ì‚¬ê°€') ? ' class="price-value"' : '';
const quantityClass = col.label === 'ìˆ˜ëŸ‰' ? ' class="quantity-cell"' : '';
tableHTML += `<td data-label="${col.label}"${priceClass}${quantityClass}>${value}</td>`;
});
tableHTML += '</tr>';
});

if (products.length > 0) {
const totalAmount = state[tabName].totalAmount;
const colCount = displayColumns.length;
const isMobile = window.innerWidth <= 768;

if (isMobile) {
if (tabName === 'ace') {
// ACE íƒ­ ëª¨ë°”ì¼: ì¹´ë“œë·°ëŠ” í…Œì´ë¸” ì™¸ë¶€ì—ì„œ ë³„ë„ë¡œ ì¶”ê°€ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
// ê¸°ì¡´ í…Œì´ë¸” ì´í•©ê³„ í–‰ì„ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
} else {
// ESSA íƒ­ ëª¨ë°”ì¼: ì´í•©ê³„ í–‰ ì œê±° (í–‰ì‚¬ê°€ ì—´ì— ê°œë³„ í• ì¸ ì ìš©)
}
} else {
if (tabName === 'ace') {
// ACE íƒ­ PC: í• ì¸ìœ¨ê³¼ ìƒí’ˆê¶Œ í¬í•¨ ì´í•©ê³„ (í• ì¸ìœ¨ â†’ ìƒí’ˆê¶Œ â†’ ì´í•©ê³„ â†’ ê¸ˆì•¡ ìˆœì„œ)
tableHTML += `<tr class="total-row">`;
tableHTML += `<td class="discount-cell">`;
tableHTML += `<div class="discount-container">`;
tableHTML += `<label for="discount-rate-pc">í• ì¸ìœ¨:</label>`;
tableHTML += `<input type="number" id="discount-rate-pc" class="discount-input-pc" value="0" min="0" max="100" step="1" onchange="applyDiscount()" oninput="applyDiscount()">`;
tableHTML += `<span>%</span>`;
tableHTML += `</div>`;
tableHTML += `</td>`;
tableHTML += `<td class="discount-cell">`;
tableHTML += `<div class="discount-container">`;
tableHTML += `<label for="regional-discount-rate-pc">ìƒí’ˆê¶Œ:</label>`;
tableHTML += `<input type="number" id="regional-discount-rate-pc" class="regional-discount-input-pc" value="0" min="0" max="100" step="1" onchange="applyDiscount()" oninput="applyDiscount()">`;
tableHTML += `<span>%</span>`;
tableHTML += `</div>`;
tableHTML += `</td>`;
tableHTML += `<td colspan="${colCount - 3}" class="total-label">ì´ í•©ê³„</td>`;
tableHTML += `<td class="total-amount">`;
tableHTML += `<div class="total-price-container">`;
tableHTML += `<span class="original-price" id="original-total-pc">${formatPrice(totalAmount)}ì›</span>`;
tableHTML += `<span class="price-separator"> / </span>`;
tableHTML += `<span class="final-price" id="final-total-pc">${formatPrice(totalAmount)}ì›</span>`;
tableHTML += `</div>`;
tableHTML += `</td>`;
tableHTML += `</tr>`;
} else {
// ESSA íƒ­ PC: ì´í•©ê³„ í–‰ ì œê±° (í–‰ì‚¬ê°€ ì—´ì— ê°œë³„ í• ì¸ ì ìš©)
}
}
}

tableHTML += `</tbody></table>`;

// ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ í• ì¸ìœ¨ ì¹´ë“œë·° ì¶”ê°€ (ESSA, ACE íƒ­ ëª¨ë‘)
const isMobileCheck = window.innerWidth <= 768;
if (isMobileCheck && products.length > 0) {
const currentTotalAmount = state[tabName].totalAmount || 0;
const cardClass = tabName === 'ace' ? 'ace-mobile-summary-card' : 'essa-mobile-summary-card';
const discountRateId = tabName === 'ace' ? 'discount-rate' : 'essa-amount-discount-mobile';
const regionalDiscountRateId = tabName === 'ace' ? 'regional-discount-rate' : 'essa-discount-rate-mobile';
const originalTotalId = tabName === 'ace' ? 'original-total' : 'essa-original-total-mobile';
const finalTotalId = tabName === 'ace' ? 'final-total' : 'essa-final-total-mobile';
const applyFunction = tabName === 'ace' ? 'applyDiscount()' : 'applyEssaDiscount()';
const resetDiscountFunction = tabName === 'ace' ? 'resetDiscountRate()' : 'resetEssaAmountDiscount()';
const resetRegionalFunction = tabName === 'ace' ? 'resetRegionalDiscountRate()' : 'resetEssaDiscountRate()';

tableHTML += `<div class="${cardClass}">`;
tableHTML += `<div class="summary-row">`;
if (tabName === 'ace') {
    tableHTML += `<span class="summary-label">í• ì¸ìœ¨</span>`;
    tableHTML += `<div class="summary-input-group">`;
    tableHTML += `<input type="number" id="${discountRateId}" class="summary-input" value="0" min="0" max="100" step="1" onchange="${applyFunction}" oninput="${applyFunction}" onfocus="selectAllOnFocus(this)" placeholder="0">`;
    tableHTML += `<span class="summary-unit">%</span>`;
} else {
    tableHTML += `<span class="summary-label">ê¸ˆì•¡í• ì¸</span>`;
    tableHTML += `<div class="summary-input-group">`;
    tableHTML += `<input type="text" id="${discountRateId}" class="summary-input" value="0" onchange="${applyFunction}" oninput="formatAmountInputMobile(this)" onfocus="selectAllOnFocus(this)" placeholder="0" style="width: 100px; text-align: right;">`;
    tableHTML += `<span class="summary-unit">ì›</span>`;
}
tableHTML += `<button class="reset-button" onclick="${resetDiscountFunction}" title="ì´ˆê¸°í™”">ë¦¬ì…‹</button>`;
tableHTML += `</div>`;
tableHTML += `</div>`;
tableHTML += `<div class="summary-row">`;
if (tabName === 'ace') {
    tableHTML += `<span class="summary-label">ìƒí’ˆê¶Œ</span>`;
    tableHTML += `<div class="summary-input-group">`;
    tableHTML += `<input type="number" id="${regionalDiscountRateId}" class="summary-input" value="0" min="0" max="100" step="1" onchange="${applyFunction}" oninput="${applyFunction}" onfocus="selectAllOnFocus(this)" placeholder="0">`;
    tableHTML += `<span class="summary-unit">%</span>`;
} else {
    tableHTML += `<span class="summary-label">í• ì¸ìœ¨</span>`;
    tableHTML += `<div class="summary-input-group">`;
    tableHTML += `<input type="text" id="${regionalDiscountRateId}" class="summary-input" value="0" onchange="${applyFunction}" oninput="formatDiscountRateInput(this)" onfocus="selectAllOnFocus(this)" placeholder="0" style="width: 85px; text-align: right;">`;
    tableHTML += `<span class="summary-unit">%</span>`;
}
tableHTML += `<button class="reset-button" onclick="${resetRegionalFunction}" title="ì´ˆê¸°í™”">ë¦¬ì…‹</button>`;
tableHTML += `</div>`;
tableHTML += `</div>`;
if (tabName === 'ace') {
    tableHTML += `<div class="summary-row">`;
    tableHTML += `<span class="summary-label">ì´ í•©ê³„</span>`;
    tableHTML += `<div class="summary-total-container">`;
    tableHTML += `<span class="summary-original-price" id="${originalTotalId}">${formatPrice(currentTotalAmount)}ì›</span>`;
    tableHTML += `<span class="summary-separator"> / </span>`;
    tableHTML += `<span class="summary-final-price" id="${finalTotalId}">${formatPrice(currentTotalAmount)}ì›</span>`;
    tableHTML += `</div>`;
    tableHTML += `</div>`;
}
tableHTML += `</div>`;
}

tableHTML += `<div style="margin-top: 10px; color: #666; font-size: 14px; text-align: center;">`;
tableHTML += `ì´ ${products.length}ê°œì˜ ì œí’ˆì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;

document.getElementById(`results-container-${tabName}`).innerHTML = sortHTML + tableHTML;
}

function handleSort(sortType, tabName) {
if (state[tabName].currentProducts.length === 0) return;

state[tabName].currentSort = sortType;
let sortedProducts = [...state[tabName].currentProducts];

if (sortType === 'asc' || sortType === 'desc') {
sortedProducts.sort((a, b) => {
const priceA = getPriceValue(a);
const priceB = getPriceValue(b);
return sortType === 'asc' ? priceA - priceB : priceB - priceA;
});
}

displayResults(sortedProducts, tabName);
}

function resetForm(tabName) {
const fieldMapping = CONFIG.FIELD_MAPPING[tabName];
Object.keys(fieldMapping).forEach(key => {
const element = document.getElementById(`${tabName}_${key}`);
if (element) {
element.value = '';
}
});

document.getElementById(`results-container-${tabName}`).innerHTML = '';
state[tabName].currentProducts = [];
state[tabName].currentSort = 'none';
state[tabName].totalAmount = 0;

if (tabName === 'ace') {
resetDependentOptions(tabName);
} else {
resetEssaDependentOptions();
}
}

// ìˆ˜ëŸ‰ ë³€ê²½ í•¨ìˆ˜
function updateQuantity(index, quantity, tabName) {
if (tabName !== 'ace') return;

const qty = parseInt(quantity) || 1;
const priceElement = document.querySelector(`[data-index="${index}"]`);

if (priceElement) {
const originalPrice = parseInt(priceElement.getAttribute('data-original')) || 0;
const totalPrice = originalPrice * qty;
priceElement.textContent = formatPrice(totalPrice) + 'ì›';
}

// ì´í•©ê³„ ì¬ê³„ì‚°
calculateAceTotal();
}

// ACE íƒ­ ì´í•©ê³„ ê³„ì‚°
function calculateAceTotal() {
let total = 0;
const priceElements = document.querySelectorAll('.total-price[data-index]');

priceElements.forEach(element => {
const originalPrice = parseInt(element.getAttribute('data-original')) || 0;
const row = element.closest('tr');
const quantityInput = row.querySelector('.quantity-input');
const quantity = parseInt(quantityInput?.value) || 1;
total += originalPrice * quantity;
});

// state ì—…ë°ì´íŠ¸
state.ace.totalAmount = total;

// í• ì¸ìœ¨ ì ìš©í•˜ì—¬ ìµœì¢… ê¸ˆì•¡ ê³„ì‚°
applyDiscount();
}

// í• ì¸ìœ¨ ì ìš© í•¨ìˆ˜
function applyDiscount() {
const baseTotal = state.ace.totalAmount || 0;
const discountRateMobile = document.getElementById('discount-rate');
const discountRatePC = document.getElementById('discount-rate-pc');
const regionalDiscountRateMobile = document.getElementById('regional-discount-rate');
const regionalDiscountRatePC = document.getElementById('regional-discount-rate-pc');

let discountRate = 0;
let regionalDiscountRate = 0;

// í• ì¸ìœ¨ ì²˜ë¦¬
if (discountRateMobile) {
discountRate = parseFloat(discountRateMobile.value) || 0;
// PC ì…ë ¥ í•„ë“œì™€ ë™ê¸°í™”
if (discountRatePC) {
discountRatePC.value = discountRate;
}
} else if (discountRatePC) {
discountRate = parseFloat(discountRatePC.value) || 0;
// ëª¨ë°”ì¼ ì…ë ¥ í•„ë“œì™€ ë™ê¸°í™”
if (discountRateMobile) {
discountRateMobile.value = discountRate;
}
}

// ìƒí’ˆê¶Œìœ¨ ì²˜ë¦¬
if (regionalDiscountRateMobile) {
regionalDiscountRate = parseFloat(regionalDiscountRateMobile.value) || 0;
// PC ì…ë ¥ í•„ë“œì™€ ë™ê¸°í™”
if (regionalDiscountRatePC) {
regionalDiscountRatePC.value = regionalDiscountRate;
}
} else if (regionalDiscountRatePC) {
regionalDiscountRate = parseFloat(regionalDiscountRatePC.value) || 0;
// ëª¨ë°”ì¼ ì…ë ¥ í•„ë“œì™€ ë™ê¸°í™”
if (regionalDiscountRateMobile) {
regionalDiscountRateMobile.value = regionalDiscountRate;
}
}

// ìƒˆë¡œìš´ í• ì¸ ì ìš© ê³„ì‚°: (íŒë§¤ê°€ í•©ê³„ * (1-í• ì¸ìœ¨)) * (1-ìƒí’ˆê¶Œ)
const afterDiscountTotal = baseTotal * (1 - discountRate / 100);
const finalDiscountedTotal = afterDiscountTotal * (1 - regionalDiscountRate / 100);

// ì²œë‹¨ìœ„ ì´í•˜ ROUNDUP ì ìš©
const finalTotal = Math.ceil(finalDiscountedTotal / 1000) * 1000;

// ìµœì¢… ê¸ˆì•¡ ì—…ë°ì´íŠ¸
const originalTotalMobile = document.getElementById('original-total');
const originalTotalPC = document.getElementById('original-total-pc');
const finalTotalMobile = document.getElementById('final-total');
const finalTotalPC = document.getElementById('final-total-pc');

// íŒë§¤ê°€ í•©ê³„ (ì›ë˜ ê°€ê²©) ì—…ë°ì´íŠ¸
if (originalTotalMobile) {
originalTotalMobile.textContent = formatPrice(baseTotal) + 'ì›';
}
if (originalTotalPC) {
originalTotalPC.textContent = formatPrice(baseTotal) + 'ì›';
}

// í• ì¸ê°€ (ìµœì¢… ê°€ê²©) ì—…ë°ì´íŠ¸
if (finalTotalMobile) {
finalTotalMobile.textContent = formatPrice(finalTotal) + 'ì›';
}
if (finalTotalPC) {
finalTotalPC.textContent = formatPrice(finalTotal) + 'ì›';
}

// í• ì¸ ì •ë³´ í‘œì‹œ
updateDiscountInfo(baseTotal, discountRate, regionalDiscountRate, finalTotal);
}

// í• ì¸ ì •ë³´ ì—…ë°ì´íŠ¸
function updateDiscountInfo(baseTotal, discountRate, regionalDiscountRate, finalTotal) {
if (discountRate > 0 || regionalDiscountRate > 0) {
const totalDiscountAmount = baseTotal - finalTotal;
console.log(`í• ì¸ ì ìš©: í• ì¸ìœ¨ ${discountRate}%, ìƒí’ˆê¶Œ ${regionalDiscountRate}% (ì´ ${formatPrice(Math.round(totalDiscountAmount))}ì› í• ì¸)`);
}
}

// ESSA íƒ­ í• ì¸ìœ¨ ì ìš© í•¨ìˆ˜
function applyEssaDiscount() {
const amountDiscountPC = document.getElementById('essa-amount-discount');
const amountDiscountMobile = document.getElementById('essa-amount-discount-mobile');
const discountRatePC = document.getElementById('essa-discount-rate');
const discountRateMobile = document.getElementById('essa-discount-rate-mobile');

let amountDiscount = 0;
let discountRate = 0;

// ê¸ˆì•¡í• ì¸ ì²˜ë¦¬ (PCì™€ ëª¨ë°”ì¼ ë™ê¸°í™”, ì²œë‹¨ìœ„ í‘œê¸° ê°’ íŒŒì‹±)
if (amountDiscountPC && amountDiscountPC.value !== undefined) {
amountDiscount = parseAmountValue(amountDiscountPC.value);
if (amountDiscountMobile) {
amountDiscountMobile.value = amountDiscount.toLocaleString('ko-KR');
}
} else if (amountDiscountMobile && amountDiscountMobile.value !== undefined) {
amountDiscount = parseAmountValue(amountDiscountMobile.value);
if (amountDiscountPC) {
amountDiscountPC.value = amountDiscount.toLocaleString('ko-KR');
}
}

// í• ì¸ìœ¨ ì²˜ë¦¬ (PCì™€ ëª¨ë°”ì¼ ë™ê¸°í™”)
if (discountRatePC && discountRatePC.value !== undefined) {
discountRate = parseFloat(discountRatePC.value) || 0;
if (discountRateMobile) {
discountRateMobile.value = discountRate.toString();
}
} else if (discountRateMobile && discountRateMobile.value !== undefined) {
discountRate = parseDiscountRateValue(discountRateMobile.value);
if (discountRatePC) {
discountRatePC.value = discountRate;
}
}

// ëª¨ë“  í–‰ì‚¬ê°€ ì—…ë°ì´íŠ¸
const eventPriceElements = document.querySelectorAll('.event-price[data-index]');
eventPriceElements.forEach(element => {
const originalPrice = parseInt(element.getAttribute('data-original')) || 0;

// í–‰ì‚¬ê°€ ì‚°ì¶œìˆ˜ì‹: (íŒë§¤ê°€ - ê¸ˆì•¡í• ì¸) * (1-í• ì¸ìœ¨)
const afterAmountDiscount = Math.max(0, originalPrice - amountDiscount);
const discountedPrice = afterAmountDiscount * (1 - discountRate / 100);

// 1000ë‹¨ìœ„ ROUNDUP ì²˜ë¦¬
const finalPrice = Math.ceil(discountedPrice / 1000) * 1000;

element.textContent = formatPrice(finalPrice) + 'ì›';
});

console.log(`ESSA í• ì¸ ì ìš©: ê¸ˆì•¡í• ì¸ ${amountDiscount.toLocaleString('ko-KR')}ì›, í• ì¸ìœ¨ ${discountRate}%`);
}

// í• ì¸ìœ¨ ë¦¬ì…‹ í•¨ìˆ˜
function resetDiscountRate() {
const discountRateMobile = document.getElementById('discount-rate');
const discountRatePC = document.getElementById('discount-rate-pc');

if (discountRateMobile) {
discountRateMobile.value = 0;
}
if (discountRatePC) {
discountRatePC.value = 0;
}

// í• ì¸ ì¬ê³„ì‚°
applyDiscount();
}

// ìƒí’ˆê¶Œ ë¦¬ì…‹ í•¨ìˆ˜
function resetRegionalDiscountRate() {
const regionalDiscountRateMobile = document.getElementById('regional-discount-rate');
const regionalDiscountRatePC = document.getElementById('regional-discount-rate-pc');

if (regionalDiscountRateMobile) {
regionalDiscountRateMobile.value = 0;
}
if (regionalDiscountRatePC) {
regionalDiscountRatePC.value = 0;
}

// í• ì¸ ì¬ê³„ì‚°
applyDiscount();
}

// ESSA íƒ­ ê¸ˆì•¡í• ì¸ ë¦¬ì…‹ í•¨ìˆ˜
function resetEssaAmountDiscount() {
const amountDiscountPC = document.getElementById('essa-amount-discount');
const amountDiscountMobile = document.getElementById('essa-amount-discount-mobile');

if (amountDiscountPC) {
amountDiscountPC.value = '0';
}
if (amountDiscountMobile) {
amountDiscountMobile.value = '0';
}

// í• ì¸ ì¬ê³„ì‚°
applyEssaDiscount();
}

// ESSA íƒ­ í• ì¸ìœ¨ ë¦¬ì…‹ í•¨ìˆ˜
function resetEssaDiscountRate() {
const discountRatePC = document.getElementById('essa-discount-rate');
const discountRateMobile = document.getElementById('essa-discount-rate-mobile');

if (discountRatePC) {
discountRatePC.value = 0;
}
if (discountRateMobile) {
discountRateMobile.value = 0;
}

// í• ì¸ ì¬ê³„ì‚°
applyEssaDiscount();
}

// ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì „ì²´ ì„ íƒ í•¨ìˆ˜
function selectAllOnFocus(element) {
element.select();
}

// ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ì²œë‹¨ìœ„ í‘œê¸° í•¨ìˆ˜ (PCìš©)
function formatAmountInput(element) {
let value = element.value.replace(/[^\d]/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ
if (value === '') {
element.value = '0';
} else {
let numValue = parseInt(value);
element.value = numValue.toLocaleString('ko-KR');
}
applyEssaDiscount();
}

// ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ì²œë‹¨ìœ„ í‘œê¸° í•¨ìˆ˜ (ëª¨ë°”ì¼ìš©)
function formatAmountInputMobile(element) {
let value = element.value.replace(/[^\d]/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ
if (value === '') {
element.value = '0';
} else {
let numValue = parseInt(value);
element.value = numValue.toLocaleString('ko-KR');
}
applyEssaDiscount();
}

// í• ì¸ìœ¨ ì…ë ¥ í•„ë“œ í¬ë§·íŒ… í•¨ìˆ˜ (ëª¨ë°”ì¼ìš©)
function formatDiscountRateInput(element) {
let value = element.value.replace(/[^\d.]/g, ''); // ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ ì¶”ì¶œ
if (value === '') {
element.value = '0';
} else {
let numValue = parseFloat(value);
if (numValue > 100) numValue = 100; // ìµœëŒ€ 100% ì œí•œ
element.value = numValue.toString();
}
applyEssaDiscount();
}

// ì²œë‹¨ìœ„ í‘œê¸°ëœ ê°’ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
function parseAmountValue(value) {
if (typeof value === 'string') {
return parseInt(value.replace(/[^\d]/g, '')) || 0;
}
return parseInt(value) || 0;
}

// í• ì¸ìœ¨ ê°’ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
function parseDiscountRateValue(value) {
if (typeof value === 'string') {
return parseFloat(value.replace(/[^\d.]/g, '')) || 0;
}
return parseFloat(value) || 0;
}



// ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
window.switchTab = switchTab;
window.searchProducts = searchProducts;
window.resetForm = resetForm;
window.handleSort = handleSort;
window.updateDependentOptions = updateDependentOptions;
window.updateEssaDependentOptions = updateEssaDependentOptions;
window.updateQuantity = updateQuantity;
window.applyDiscount = applyDiscount;
window.applyEssaDiscount = applyEssaDiscount;
window.resetDiscountRate = resetDiscountRate;
window.resetRegionalDiscountRate = resetRegionalDiscountRate;
window.resetEssaAmountDiscount = resetEssaAmountDiscount;
window.resetEssaDiscountRate = resetEssaDiscountRate;
window.selectAllOnFocus = selectAllOnFocus;
window.formatAmountInput = formatAmountInput;
window.formatAmountInputMobile = formatAmountInputMobile;
window.formatDiscountRateInput = formatDiscountRateInput;

// GitHub ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
async function testGitHubRepository() {
const repoUrl = `https://api.github.com/repos/${CONFIG.GITHUB.username}/${CONFIG.GITHUB.repository}`;
console.log('ğŸ” GitHub ë¦¬í¬ì§€í† ë¦¬ í™•ì¸:', repoUrl);

try {
const response = await fetch(repoUrl);
if (response.ok) {
const repoInfo = await response.json();
console.log('âœ… ë¦¬í¬ì§€í† ë¦¬ ì¡´ì¬:', repoInfo.name);
console.log('ï¿½ ë¬¸ë¦¬í¬ì§€í† ë¦¬ ì •ë³´:', {
name: repoInfo.name,
private: repoInfo.private,
default_branch: repoInfo.default_branch,
html_url: repoInfo.html_url
});
return true;
} else {
console.log('âŒ ë¦¬í¬ì§€í† ë¦¬ ì ‘ê·¼ ì‹¤íŒ¨:', response.status);
return false;
}
} catch (error) {
console.log('ğŸ’¥ ë¦¬í¬ì§€í† ë¦¬ í™•ì¸ ì˜¤ë¥˜:', error);
return false;
}
}

// ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì´ˆê¸°í™” ì‹œì‘');

// GitHub ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸
testGitHubRepository().then(exists => {
if (exists) {
console.log('âœ… GitHub ë¦¬í¬ì§€í† ë¦¬ í™•ì¸ë¨');
} else {
console.log('âŒ GitHub ë¦¬í¬ì§€í† ë¦¬ ë¬¸ì œ ìˆìŒ');
}
});

initUpload();
});

// í˜ì´ì§€ê°€ ì´ë¯¸ ë¡œë“œëœ ê²½ìš°ë¥¼ ìœ„í•œ ë°±ì—…
if (document.readyState === 'loading') {
console.log('ğŸ“„ ë¬¸ì„œ ë¡œë”© ì¤‘...');
} else {
console.log('ğŸ“„ ë¬¸ì„œ ì´ë¯¸ ë¡œë“œë¨, ì¦‰ì‹œ ì´ˆê¸°í™”');
testGitHubRepository();
initUpload();
}
</script>
</body>
</html>
